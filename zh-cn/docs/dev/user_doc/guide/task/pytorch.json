{
  "filename": "pytorch.md",
  "__html": "<h1>Pytorch 节点（试验版）</h1>\n<h2>综述</h2>\n<p><a href=\"https://pytorch.org\">Pytorch</a> 是一个的主流Python机器学习库。</p>\n<p>为了用户能够在DolphinScheduler中<strong>更方便的运行Pytorch项目</strong>，实现了Pytorch任务组件。主要提供<strong>便捷的python环境管理</strong>以及支持<strong>运行python项目</strong>。</p>\n<p>与Python任务组件不同，该组件允许用户快速使用已有python环境或者创建新的python环境（使用virtualenv或者conda）；支持运行Python项目（本地项目或者Git项目）而非只是python脚本。</p>\n<h2>创建任务</h2>\n<ul>\n<li>点击项目管理-项目名称-工作流定义，点击“创建工作流”按钮，进入 DAG 编辑页面；</li>\n<li>拖动工具栏的 <img src=\"/img/tasks/icons/pytorch.png\" width=\"15\"/> 任务节点到画板中。</li>\n</ul>\n<h2>任务样例</h2>\n<p>组件图示如下：</p>\n<p><img src=\"/img/tasks/demo/pytorch_en.png\" alt=\"pytorch\"></p>\n<h3>首先介绍一些DS通用参数</h3>\n<ul>\n<li><strong>节点名称</strong> ：设置任务的名称。一个工作流定义中的节点名称是唯一的。</li>\n<li><strong>运行标志</strong> ：标识这个节点是否能正常调度,如果不需要执行，可以打开禁止执行开关。</li>\n<li><strong>描述</strong> ：描述该节点的功能。</li>\n<li><strong>任务优先级</strong> ：worker 线程数不足时，根据优先级从高到低依次执行，优先级一样时根据先进先出原则执行。</li>\n<li><strong>Worker 分组</strong> ：任务分配给 worker 组的机器执行，选择 Default，会随机选择一台 worker 机执行。</li>\n<li><strong>环境名称</strong> ：配置运行脚本的环境。</li>\n<li><strong>失败重试次数</strong> ：任务失败重新提交的次数。</li>\n<li><strong>失败重试间隔</strong> ：任务失败重新提交任务的时间间隔，以分钟为单位。</li>\n<li><strong>延迟执行时间</strong> ：任务延迟执行的时间，以分钟为单位。</li>\n<li><strong>资源</strong>：是指脚本中需要调用的资源文件列表，资源中心-文件管理上传或创建的文件。</li>\n<li><strong>自定义参数</strong>：是 SHELL 局部的用户自定义参数，会替换脚本中以 <code>${变量}</code> 的内容。</li>\n<li><strong>前置任务</strong> ：选择当前任务的前置任务，会将被选择的前置任务设置为当前任务的上游。</li>\n</ul>\n<h3>Pytorch组件独有的参数</h3>\n<h4>运行参数</h4>\n<ul>\n<li><strong>python脚本</strong> ：需要运行的python脚本文件入口。</li>\n<li><strong>脚本启动参数</strong> ：运行时的输入参数。</li>\n</ul>\n<p>以上为两个最小化配置运行的参数，另外提供其他的一些配置参数如下可选，当选择展开更多配置时，可以配置更多参数。</p>\n<ul>\n<li><strong>python项目地址</strong> ：设置<code>PYTHONPATH</code>环境变量，设置后运行python脚本时可以加载该地址下的python包/项目代码。支持本地路径或者Git url\n<ul>\n<li>若为本地路径，作为<code>PYTHONPATH</code>环境变量。</li>\n<li>如果为Git URL （以<code>git@ | https:// | http://</code>前缀），则会下载项目，并将下载后存放地址作为新的<strong>python项目地址</strong>，若需要运行子文件夹下的项目，可以添加 <code>#subdirectory</code> 来配置。</li>\n</ul>\n</li>\n</ul>\n<h4>python环境参数</h4>\n<ul>\n<li><strong>是否创建新环境</strong> ：是否创建新的python环境来运行该任务。</li>\n</ul>\n<p><em>否</em></p>\n<ul>\n<li><strong>python命令路径</strong> ：如<code>/usr/bin/python</code>，默认为DS环境配置中的<code>${PYTHON_HOME}</code>。</li>\n</ul>\n<p><em>是</em></p>\n<ul>\n<li><strong>python环境管理工具</strong> ：可以选择virtualenv或者conda。\n<ul>\n<li>若选择<code>virtualenv</code>，则会用<code>virtualenv</code>创建一个新环境，使用命令 <code>virtualenv -p ${PYTHON_HOME} venv</code> 创建</li>\n<li>若选择<code>conda</code>, 则会使用<code>conda</code> 创建一个新环境，并需要指定创建的python版本。</li>\n</ul>\n</li>\n<li><strong>依赖文件</strong> ：默认为 requirements.txt。</li>\n</ul>\n<p>配置了<code>python项目地址</code>参数，那么<code>python脚本</code>和<code>依赖文件</code>参数允许输入相对路径</p>\n<h4>Demo</h4>\n<p>如现在需要运行 <a href=\"https://github.com/pytorch/examples\">https://github.com/pytorch/examples</a> 项目下的mnist的子项目。</p>\n<p>可以设置</p>\n<p><img src=\"/img/tasks/demo/pytorch_note_en.png\" alt=\"pytorch_note\"></p>\n<p>另外如果代码存放在资源中心，则可以使用<code>资源</code>参数下载代码，并将相关参数写成对应资源的路径即可。</p>\n<h2>环境配置</h2>\n<p>环境配置主要取决于运行时python环境的选择，需要在<code>安全中心</code>-<code>环境管理</code>中配置对应需要的环境变量即可。</p>\n<h3>指定python路径</h3>\n<p>适用于worker上已经有运行该项目的python环境，那么可以直接在组件中配置<code>pyhton命令路径</code>为对应的python环境即可，如果不知道该环境地址，可以使用<code>which python</code>获取。</p>\n<h3>使用Conda创建新环境</h3>\n<p>适用于新建环境运行该项目，需要在<code>安全中心</code>-<code>环境管理</code>中创建环境, 参考如下添加修改为实际环境即可。</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> conda命令对应的目录加入PATH中</span>\nexport PATH=$HOME/anaconda3/bin:$PATH\n</code></pre>\n<h3>使用virtualenv创建新环境</h3>\n<p>适用于新建环境运行该项目，需要在<code>安全中心</code>-<code>环境管理</code>中创建环境, 参考如下添加修改为实际环境即可。</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> virtualenv命令对应的目录加入PATH中</span>\nexport PATH=/home/lucky/anaconda3/bin:$PATH\nexport PYTHON_HOME=/usr/local/bin/python3.7\n</code></pre>\n<h2>其他</h2>\n<p>本组件也可以运行xgboost, lightgbm, sklearn, tensorflow, keras 等项目。本组件可作为python组件运行机器学习任务的升级组件。</p>\n<p>如果有需要，后续建议可以统一涵盖为PythonML组件，来运行机器学习项目。</p>\n",
  "link": "/dist/zh-cn/docs/dev/user_doc/guide/task/pytorch.html",
  "meta": {}
}