<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="keywords" content="cicd_workflow">
  <meta name="description" content="cicd_workflow">
  <title>cicd_workflow</title>
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/build/vendor.23870e5.css">
  <link rel="stylesheet" href="/build/blog.md.055b3f1.css">
</head>
<body>
  <div id="root"><div class="blog-detail-page" data-reactroot=""><header class="header-container header-container-dark"><div class="header-body"><span class="mobile-menu-btn mobile-menu-btn-dark"></span><a href="/zh-cn/index.html"><img class="logo" src="/img/hlogo_white.svg"/></a><div class="search search-dark"><span class="icon-search"></span></div><span class="language-switch language-switch-dark">En</span><div class="header-menu"><div><ul class="ant-menu whiteClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="/zh-cn/docs/latest/user_doc/guide/quick-start.html" target="_self">文档</a></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/download/download.html" target="_self">下载</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item ant-menu-item-selected" role="menuitem"><a href="/zh-cn/blog/index.html" target="_self">博客</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/development/development-environment-setup.html" target="_self">开发者</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/community/team.html" target="_self">社区</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="https://www.apache.org/" target="_blank">ASF</a></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/user/index.html" target="_self">用户</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div><div class="mobile-menu"><div class="mobile-menu-content"><div class="mobile-menu-list"><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/index.html" target="_self">首页</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/docs/latest/user_doc/guide/quick-start.html" target="_self">文档</a><em class="mobile-menu-icon"></em><div class="mobile-sub-menus"><div class="mobile-sub-menu-item"><a href="/zh-cn/docs/latest/user_doc/guide/quick-start.html" target="_self">最新版本latest(2.0.5)</a></div><div class="mobile-sub-menu-item"><a href="/zh-cn/docs/1.3.9/user_doc/quick-start.html" target="_self">1.3.9</a></div><div class="mobile-sub-menu-item"><a href="/zh-cn/docs/release/history-versions.html" target="_self">历史版本</a></div><div class="mobile-sub-menu-item"><a href="/python/index.html" target="_self">PyDolphinScheduler</a></div><div class="mobile-sub-menu-item"><a href="/zh-cn/docs/dev/user_doc/about/introduction.html" target="_self">dev</a></div></div></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/download/download.html" target="_self">下载</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/blog/index.html" target="_self">博客</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/development/development-environment-setup.html" target="_self">开发者</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/community/team.html" target="_self">社区</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="https://www.apache.org/" target="_blank">ASF</a><em class="mobile-menu-icon"></em><div class="mobile-sub-menus"><div class="mobile-sub-menu-item"><a href="https://www.apache.org/" target="_blank">Foundation</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/licenses/" target="_blank">License</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/events/current-event" target="_blank">Events</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/security/" target="_blank">Security</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank">Sponsorship</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a></div></div></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/user/index.html" target="_self">用户</a></div></div></div><div class="mobile-menu-dummy"></div></div></div></header><section class="blog-content markdown-body"><h1>用DolphinScheduler建立java项目的CI/CD工作流</h1>
<h3>CI/CD 流程介绍</h3>
<p>CI/CD中包含一系列步骤，来自动化我们开发阶段的软件交付过程，使其可以频繁地输送准确的代码。CI/CD 的核心概念是持续集成、持续交付和持续部署。作为一个面向开发和运营团队的解决方案，CI/CD 主要针对在集成新代码时所引发的问题。</p>
<p>这里的CI 指持续集成，这个过程是自动化的，以确保团队能够以可靠和可重复的方式构建、测试和打包他们的应用程序。 CI 有助于简化代码更改流程，从而增加开发人员进行更改和改进软件的时间。</p>
<p>CD 指持续交付/持续部署。持续交付代表将完成的代码自动交付到测试和开发等环境中。 CD 为将代码交付到这些环境提供了一种自动化且一致的方式。持续部署是持续交付的下一步。通过自动化测试的每个更改都会自动投入生产环境中，从而在生产环境下部署。</p>
<p>这个针对项目的CI/CD工作流主要有三个：打包(packaging)，回滚(roll back)，特性发布(feature release)。</p>
<p>打包阶段的主要内容是检查本地代码库是否为最新版本，后进行构建，测试，部署到模拟环境中。若打包顺利完成，本地会产生一个新的版本，并且可以在模拟环境中检查此新版本。</p>
<p>回滚的目的是显示已有的发布版本，调用其中一个选定的版本，将其部署到生产环境。特性发布的内容与回滚大体相似，但不同的是，在这个工作流中，显示已有的特性发布版本，再调用其中一个并部署到生产环境。</p>
<h3>基于 DS 实现 CI/CD pipeline 实例</h3>
<p>基于现有的ds功能，我们找到一个小型项目当作此次尝试的范例。被选中的项目<a href="https://github.com/jonashackt/spring-boot-vuejs">spring-boot-vuejs</a> 具有前端和后端，可以较为直观的看到部署的结果，它的CI/CD流程也比较简明。这个实例中，我们采用的部署形式是本地部署/单机部署，不考虑到多台机器或者集群的影响。在为项目工作流配置完全局变量和本地变量后，便可以使其上线运行，完成的工作流如下。</p>
<h5>Packaging</h5>
<p>这个工作流共包含6个shell节点，用于CI/CD流程中的代码获取，构建，测试，打包，预发布（staging）。详见导出的<a href="/img/cicd_workflow/feature_release.json">工作流文件</a></p>
<p><img src="/img/cicd_workflow/7A715483-ABF1-44C1-AC6F-CDED1623CC07_4_5005_c.jpeg" alt="avatar"></p>
<ul>
<li>节点1: check repo
这个节点的目的是检查本地是否已经有最新的代码版本，分别通过git clone和git pull获取代码库和更新。环节的开始和结束，均会在日志中有提醒。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-comment"># Check Java version, Maven version and Git Branch</span>
<span class="hljs-built_in">echo</span> Show supporting info
java -version
mvn --version
<span class="hljs-comment"># choose a local directory to store this project</span>
<span class="hljs-comment"># cd /opt/repo</span>

<span class="hljs-built_in">echo</span> Start of repo checkout/update
<span class="hljs-comment"># Check if project&#x27;s repo is under the chosen directory. </span>
<span class="hljs-comment"># If available, pull the latest version, if not, clone</span>
DIR=<span class="hljs-string">&quot;<span class="hljs-variable">${project_folder}</span>&quot;</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$DIR</span>&quot;</span> ]; <span class="hljs-keyword">then</span>
  <span class="hljs-comment">### Pull latest if $DIR exists ###</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Pass: <span class="hljs-variable">${DIR}</span> exist&quot;</span>
  <span class="hljs-built_in">cd</span> <span class="hljs-variable">$DIR</span>
  git status
  git pull origin master
  <span class="hljs-built_in">echo</span> spring-boot-vuejs
<span class="hljs-keyword">else</span>
  <span class="hljs-comment">### Clone if $DIR does NOT exist ###</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Error: <span class="hljs-variable">${DIR}</span> not found. Clone repo&quot;</span>
  git <span class="hljs-built_in">clone</span> https://github.com/jonashackt/spring-boot-vuejs
  <span class="hljs-built_in">cd</span> spring-boot-vuejs
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">echo</span> End of repo checkout/update
</code></pre>
<p>如果节点运行成功，本地已存在目标代码库，此时可以执行git pull (前提保证本地更新已经提交) 。</p>
<p><img src="/img/cicd_workflow/6A1478C7-3824-47F5-9E48-5BC04FB20B3E.jpeg" alt="avatar"></p>
<ul>
<li>节点2: build with java8
这个节点基于项目使用java的maven框架，进行构建。因为此实例使用的java版本为8和16。以本地默认java版本java8执行命令。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span> 
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

JAVA_HOME=<span class="hljs-variable">${java8_path}</span>
java -version
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span>

npm config <span class="hljs-built_in">set</span> registry http://registry.npmjs.org   
mvn -B install --no-transfer-progress 
</code></pre>
<p>如果节点运行成功，日志中会出现“BUILD SUCCESS”，显示构建完成并且成功。</p>
<p><img src="/img/cicd_workflow/D48B0EAD-D0A0-40D3-AD19-0A19F83DD39E.jpeg" alt="avatar"></p>
<ul>
<li>节点3: test with java8
这个节点在同一个java版本下运行单元测试。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span> 
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

mvn -B verify --no-transfer-progress 
</code></pre>
<p>如果节点运行成功，日志中会出现“BUILD SUCCESS”，显示测试成功。</p>
<p><img src="/img/cicd_workflow/CB12C170-A17C-4C1A-8078-2CC67B8BAB31.jpeg" alt="avatar"></p>
<ul>
<li>节点4: build with java16
这个节点基于项目使用java的maven框架，进行构建。因为已经用java8进行了构建，所以这里更换为java16后执行构建命令。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span> 
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

java -version
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span>

JAVA_HOME=<span class="hljs-variable">${java16_path}</span>
<span class="hljs-built_in">export</span> JAVA_HOME;
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span>

npm config <span class="hljs-built_in">set</span> registry http://registry.npmjs.org   
mvn -B install --no-transfer-progress 
</code></pre>
<p>如果节点运行成功，日志中会出现”BUILD SUCCESS“，显示构建成功。</p>
<p><img src="/img/cicd_workflow/29CAB894-5281-4740-8E39-897E96571D6A.jpeg" alt="avatar"></p>
<ul>
<li>节点5: test with java16
这个节点在同一个java版本下运行单元测试。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span> 
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

mvn -B verify --no-transfer-progress 
</code></pre>
<p>如果节点运行成功，日志中会出现”BUILD SUCCESS“，显示测试成功。</p>
<p><img src="/img/cicd_workflow/B5B15323-7379-4332-AEAC-7E70DBE2F924.jpeg" alt="avatar"></p>
<ul>
<li>节点6: staging
这个节点在项目预发布的模拟环境中部署，本地部署到端口 <a href="http://localhost:5000">http://localhost:5000</a> 。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span> 
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

JAVA_HOME=<span class="hljs-variable">${java8_path}</span>
<span class="hljs-built_in">export</span> JAVA_HOME;
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span>

<span class="hljs-built_in">echo</span> START
nohup java -Djava.security.egd=file:/dev/./urandom -jar ./backend/target/backend-0.0.3-SNAPSHOT.jar --server.port=<span class="hljs-variable">${staging_port}</span> &gt; buildres_staging.txt 2&gt;&amp;1 &amp;
<span class="hljs-built_in">echo</span> END
</code></pre>
<p>如果节点运行成功，因为使用nohup命令，部署至本地端口的命令在后台进行，日志中会出现“START”和“END”代表此命令的执行情况。日志显示如下</p>
<p><img src="/img/cicd_workflow/1989B620-63EC-45C8-B148-22CD5F2AB528.jpeg" alt="avatar"></p>
<p>同时，因为staging_port变量在此处被设置为 localhost:5000 ，所以在本地也可以看到部署完成的页面如下</p>
<p><img src="/img/cicd_workflow/3AB6D6CE-CDB2-451E-9524-BF2224C947C0.jpeg" alt="avatar"></p>
<h5>Rollback</h5>
<p>这个工作流共包含三个shell节点，用于完成项目版本回滚，也相当于CI/CD流程中的生产部署环节。详见导出的<a href="/img/cicd_workflow/rollback.json">工作流文件</a></p>
<p><img src="/img/cicd_workflow/12D3F0CE-18FE-4163-951A-4E0734A42EC2_4_5005_c.jpeg" alt="avatar"></p>
<ul>
<li>节点1: kill process on port
这个节点用于关闭要部署的端口的现有进程，为节点3作准备。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

<span class="hljs-keyword">if</span> [[ $(lsof -ti:<span class="hljs-variable">${port_number}</span> | wc -l) -gt 0 ]]; 
	<span class="hljs-keyword">then</span> 
    	<span class="hljs-built_in">echo</span> process found
        sudo <span class="hljs-built_in">kill</span> -9 $(lsof -ti:<span class="hljs-variable">${port_number}</span>); 
    <span class="hljs-keyword">fi</span>
</code></pre>
<p>如果节点运行成功，要检查的端口的确有进程，日志中会显示如下图“process found”，之后这些进程会被关闭。</p>
<p><img src="/img/cicd_workflow/962BFAD9-5695-4369-B2D5-F4185C229CCB.jpeg" alt=""></p>
<ul>
<li>节点2: display available version
这个节点用于展示本地所有可以被调用的发布版本。假定所有的发布版本都遵循命名格式backend-X.0.0-RELEASE.jar，那么所有包含关键字“RELEASE ”的版本都会被筛选并显示出来，供下一步使用。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

<span class="hljs-comment"># see previous releases</span>
find /opt/repo/spring-boot-vuejs/backend/target -iname <span class="hljs-string">&#x27;*${keyword}*&#x27;</span>
</code></pre>
<p>如果节点运行成功，本地所有发布版本都会被列举出来，以供选择调用。</p>
<p><img src="/img/cicd_workflow/51656174-4F3A-4A73-94FA-7E12D5B6FF27.jpeg" alt=""></p>
<ul>
<li>节点3: roll back
这个节点用于选定回滚的目标版本，并且本地部署到端口。部署成功则可以在本地8098端口显示页面。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

JAVA_HOME=<span class="hljs-variable">${java8_path}</span>
<span class="hljs-built_in">export</span> JAVA_HOME;
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span>

<span class="hljs-comment"># fill in desired version to roll back to previous release</span>
<span class="hljs-built_in">echo</span> START
nohup java -Djava.security.egd=file:/dev/./urandom -jar ./backend/target/backend-1.0.0-RELEASE.jar --server.port=<span class="hljs-variable">${port_number}</span> &gt; buildres_production.txt 2&gt;&amp;1 &amp;
<span class="hljs-built_in">echo</span> END
</code></pre>
<p>如果节点运行成功，部署至本地端口的nohup命令在后台进行，日志中出现“START”和“END”代表此命令的执行情况。日志显示如下</p>
<p><img src="/img/cicd_workflow/902CAC66-44A6-457E-BF87-534010FE6585.jpeg" alt=""></p>
<p>同时，因为port_number变量在此处被设置为localhost：8098，所以在本地也可以看到部署完成的页面如下</p>
<p><img src="/img/cicd_workflow/3AB6D6CE-CDB2-451E-9524-BF2224C947C0.jpeg" alt=""></p>
<h5>Feature Release</h5>
<p>这个工作流共包含三个shell节点，用于完成项目版本回滚，也相当于CI/CD流程中的生产部署环节。详见导出的<a href="/img/cicd_workflow/feature_release.json">工作流文件</a></p>
<p><img src="/img/cicd_workflow/5162B6A2-67C8-4EAD-BE7A-992D0AE90CD1_4_5005_c.jpeg" alt="avatar"></p>
<ul>
<li>节点1: kill process on port
这个节点用于关闭要部署的端口的现有进程，为节点3作准备。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

<span class="hljs-keyword">if</span> [[ $(lsof -ti:<span class="hljs-variable">${port_number}</span> | wc -l) -gt 0 ]]; 
	<span class="hljs-keyword">then</span> 
    	<span class="hljs-built_in">echo</span> process found
        sudo <span class="hljs-built_in">kill</span> -9 $(lsof -ti:<span class="hljs-variable">${port_number}</span>); 
    <span class="hljs-keyword">fi</span>
</code></pre>
<p>如果要检查的端口的确有进程，日志中会显示如下图“process found”，之后这些进程会被关闭。</p>
<p><img src="/img/cicd_workflow/00282F58-D216-470A-A65D-90EE09C76DED.jpeg" alt=""></p>
<ul>
<li>节点2: display available version
这个节点用于展示本地所有可以被调用的特性发布版本。假定所有的特性发布版本都遵循命名格式backend-0.0.1-SNAPSHOT.jar，那么所有包含关键字“SNAPSHOT”的版本都会被筛选并显示出来，供下一步使用。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

<span class="hljs-comment"># see previous releases</span>
find /opt/repo/spring-boot-vuejs/backend/target -iname <span class="hljs-string">&#x27;*${keyword}*&#x27;</span>
</code></pre>
<p>如果节点运行成功，本地所有特性发布版本都会被列举出来，以供选择调用。</p>
<p><img src="/img/cicd_workflow/F595066F-EE0B-4086-AD92-5BAF081792F9.jpeg" alt=""></p>
<ul>
<li>节点3: release
这个节点用于选定特性发布的目标版本，并且本地部署到端口。部署成功则可以在本地8098端口显示页面。</li>
</ul>
<pre><code class="language-sh"><span class="hljs-built_in">pwd</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">${project_folder}</span>

JAVA_HOME=<span class="hljs-variable">${java8_path}</span>
<span class="hljs-built_in">export</span> JAVA_HOME;
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$JAVA_HOME</span>

<span class="hljs-comment"># fill in desired version to roll back to previous release</span>
<span class="hljs-built_in">echo</span> START
nohup java -Djava.security.egd=file:/dev/./urandom -jar ./backend/target/backend-0.0.3-SNAPSHOT.jar --server.port=<span class="hljs-variable">${port_number}</span> &gt; buildres_production.txt 2&gt;&amp;1 &amp;
<span class="hljs-built_in">echo</span> END
</code></pre>
<p>如果节点运行成功，部署至本地端口的nohup命令在后台进行，日志中出现“START”和“END”代表此命令的执行情况。日志显示如下</p>
<p><img src="/img/cicd_workflow/BFE0DB23-148B-4D0E-8C4D-C7DB51570593.jpeg" alt=""></p>
<p>同时，因为port_number变量在此处被设置为 localhost:8098，所以在本地也可以看到部署完成的页面如下</p>
<p><img src="/img/cicd_workflow/3AB6D6CE-CDB2-451E-9524-BF2224C947C0.jpeg" alt=""></p>
<h3>使用DS构建工作流不足之处</h3>
<h5>项目中觉得使用ds来构建ci/cd 工作流不方便的地方：</h5>
<p>目前DS没有对于工作流或者节点的版本管理，例如不能给一个工作流的当前版本take snapshot，以便后续需要时使用。现在需要通过GitHub、Gitlab或者其他版本管理平台，才能完成例如将单个节点回滚到历史版本的任务。如果用户从DAG中删除一个节点或节点中的任务，并重新部署它，那么与该任务相关的元数据(metadata)就会失去。</p>
<p>在单机部署时，工作流中所有节点并不处在同一个独立的虚拟环境里。每个节点都指向一个/tmp/dolphinscheduler/exec/process/下的不同路径，如果需要获取之前节点的信息，需要指定一个文件夹存储项目的源代码，每次进入文件夹来获取代码。但这也可以通过设置全局变量来解决。</p>
<h5>与现有的CI/CD工具相比</h5>
<p>对于***本地部署***的ds来说，虚拟环境完全依赖本机的环境。例如在这次的工作流中，需要提前在本地设置好需要的java版本和maven 版本，虚拟环境中的相应命令才能执行。然而在Github Actions中，运行工作流的环境可以通过yaml文件内的设置，直接拉取对应的Docker image镜像而生成，独立于本地环境。</p>
<p>与Github Actions相比，ds需要手动上线和启动CI/CD工作流，不能用类似on：[push] 这种GitHub event作为触发机制。</p>
</section><footer class="footer-container"><div class="footer-body"><div><h3>联系我们</h3><h4>有问题需要反馈？请通过以下方式联系我们。</h4></div><div class="contact-container"><ul><li><a href="/zh-cn/community/development/subscribe.html"><img class="img-base" src="/img/emailgray.png"/><img class="img-change" src="/img/emailblue.png"/><p>邮件列表</p></a></li><li><a href="https://twitter.com/dolphinschedule"><img class="img-base" src="/img/twittergray.png"/><img class="img-change" src="/img/twitterblue.png"/><p>Twitter</p></a></li><li><a href="https://stackoverflow.com/questions/tagged/apache-dolphinscheduler"><img class="img-base" src="/img/stackoverflow.png"/><img class="img-change" src="/img/stackoverflow-selected.png"/><p>Stack Overflow</p></a></li><li><a href="https://join.slack.com/t/asf-dolphinscheduler/shared_invite/zt-omtdhuio-_JISsxYhiVsltmC5h38yfw"><img class="img-base" src="/img/slack.png"/><img class="img-change" src="/img/slack-selected.png"/><p>Slack</p></a></li></ul></div><div class="cols-container"><div class="docu-container"><h4>文档</h4><ul><li><a href="/zh-cn/development/architecture-design.html"><p>概览</p></a></li><li><a href="/zh-cn/docs/latest/user_doc/guide/quick-start.html"><p>快速开始</p></a></li><li><a href="/zh-cn/development/development-environment-setup.html"><p>开发者指南</p></a></li></ul></div><div></div><div class="asf-container"><h4>ASF</h4><ul><li><a href="http://www.apache.org"><p>基金会</p></a></li><li><a href="http://www.apache.org/licenses/"><p>证书</p></a></li><li><a href="http://www.apache.org/events/current-event"><p>事件</p></a></li><li><a href="http://www.apache.org/foundation/sponsorship.html"><p>赞助</p></a></li><li><a href="http://www.apache.org/foundation/thanks.html"><p>致谢</p></a></li></ul></div></div><div class="copyright"><span>Copyright © 2019-2021 The Apache Software Foundation. Apache DolphinScheduler, DolphinScheduler, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
  <script src="//cdn.jsdelivr.net/npm/react@15.6.2/dist/react-with-addons.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/react-dom@15.6.2/dist/react-dom.min.js"></script>
  <script>window.rootPath = '';</script>
  <script src="/build/vendor.90dcf97.js"></script>
  <script src="/build/blog.md.f25cabd.js"></script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4e7b4b400dd31fa015018a435c64d06f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-899J8PYKJZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-899J8PYKJZ');
  </script>
</body>
</html>