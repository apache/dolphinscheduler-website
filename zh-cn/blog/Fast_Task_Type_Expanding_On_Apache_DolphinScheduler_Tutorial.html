<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="keywords" content="Fast_Task_Type_Expanding_On_Apache_DolphinScheduler_Tutorial">
  <meta name="description" content="Fast_Task_Type_Expanding_On_Apache_DolphinScheduler_Tutorial">
  <title>Fast_Task_Type_Expanding_On_Apache_DolphinScheduler_Tutorial</title>
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/build/vendor.eeae4ed.css">
  <link rel="stylesheet" href="/build/blog.md.055b3f1.css">
</head>
<body>
  <div id="root"><div class="blog-detail-page" data-reactroot=""><header class="header-container header-container-dark"><div class="banner-tips"><div>ğŸ¤” æœ‰å…³äº Apache DolphinScheduler çš„ç–‘é—®ï¼ŒåŠ å…¥ Slack é¢‘é“æ¥è®¨è®ºä»–ä»¬ <a class="link-tips" href="https://s.apache.org/dolphinscheduler-slack">join #dolphinscheduler channel</a>! ğŸŒŸ</div></div><div class="header-body"><span class="mobile-menu-btn mobile-menu-btn-dark"></span><a href="/zh-cn/index.html"><img class="logo" src="/img/hlogo_white.svg"/></a><div class="search search-dark"><span class="icon-search"></span></div><span class="language-switch language-switch-dark">En</span><div class="header-menu"><div><ul class="ant-menu whiteClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/index.html" target="_self">é¦–é¡µ</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="/zh-cn/docs/latest/user_doc/about/introduction.html" target="_self">æ–‡æ¡£</a></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/download/download.html" target="_self">ä¸‹è½½</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item ant-menu-item-selected" role="menuitem"><a href="/zh-cn/blog/index.html" target="_self">åšå®¢</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/development/development-environment-setup.html" target="_self">å¼€å‘è€…</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/community/team.html" target="_self">ç¤¾åŒº</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="https://www.apache.org/" target="_blank">ASF</a></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/user/index.html" target="_self">ç”¨æˆ·</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>Â·Â·Â·</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div><div class="mobile-menu"><div class="mobile-menu-content"><div class="mobile-menu-list"><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/index.html" target="_self">é¦–é¡µ</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/docs/latest/user_doc/about/introduction.html" target="_self">æ–‡æ¡£</a><em class="mobile-menu-icon"></em><div class="mobile-sub-menus"><div class="mobile-sub-menu-item"><a href="/zh-cn/docs/latest/user_doc/about/introduction.html" target="_self">æœ€æ–°ç‰ˆæœ¬latest(3.0.0-beta-2)</a></div><div class="mobile-sub-menu-item"><a href="/zh-cn/docs/1.3.9/user_doc/quick-start.html" target="_self">1.3.9</a></div><div class="mobile-sub-menu-item"><a href="/zh-cn/docs/release/history-versions.html" target="_self">å†å²ç‰ˆæœ¬</a></div></div></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/download/download.html" target="_self">ä¸‹è½½</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/blog/index.html" target="_self">åšå®¢</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/development/development-environment-setup.html" target="_self">å¼€å‘è€…</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/community/team.html" target="_self">ç¤¾åŒº</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="https://www.apache.org/" target="_blank">ASF</a><em class="mobile-menu-icon"></em><div class="mobile-sub-menus"><div class="mobile-sub-menu-item"><a href="https://www.apache.org/" target="_blank">Foundation</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/licenses/" target="_blank">License</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/events/current-event" target="_blank">Events</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/security/" target="_blank">Security</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank">Sponsorship</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a></div></div></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/zh-cn/user/index.html" target="_self">ç”¨æˆ·</a></div></div></div><div class="mobile-menu-dummy"></div></div></div></header><section class="blog-content markdown-body"><h1>æé€Ÿå¼€å‘æ‰©å…… Apache DolphinScheduler Task ç±»å‹ | å®ç”¨æ•™ç¨‹</h1>
<div align=center>
<img src="/img/2022-03-29/1.png"/>
</div>
<h2>èƒŒæ™¯ç®€ä»‹</h2>
<p>ç›®å‰åœ¨å¤§æ•°æ®ç”Ÿæ€ä¸­ï¼Œè°ƒåº¦ç³»ç»Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€ä¸ªé‡è¦ç»„ä»¶ã€‚Apache DolphinScheduler ä½œä¸ºä¸€ä¸ªé¡¶çº§çš„ Apache é¡¹ç›®ï¼Œå…¶ç¨³å®šæ€§å’Œæ˜“ç”¨æ€§ä¹Ÿå¯ä»¥è¯´æ˜¯ååˆ—å‰èŒ…çš„ã€‚è€Œå¯¹äºä¸€ä¸ªè°ƒåº¦ç³»ç»Ÿæ¥è¯´ï¼Œèƒ½å¤Ÿæ”¯æŒçš„å¯è°ƒåº¦çš„ä»»åŠ¡ç±»å‹åŒæ ·æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ ï¼Œåœ¨è°ƒåº¦ã€åˆ†å¸ƒå¼ã€é«˜å¯ç”¨ã€æ˜“ç”¨æ€§è§£å†³äº†çš„æƒ…å†µä¸‹ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•æˆ–è€…å„ç§éœ€æ±‚ä½¿ç”¨åˆ°çš„ç»„ä»¶å¢å¤šï¼Œç”¨æˆ·è‡ªç„¶è€Œç„¶ä¼šå¸Œæœ›èƒ½å¤Ÿå¿«é€Ÿã€æ–¹ä¾¿ã€ç®€æ´åœ°å¯¹ Apache Dolphinscheduler å¯è°ƒåº¦çš„ä»»åŠ¡ç±»å‹è¿›è¡Œæ‰©å……ã€‚æœ¬æ–‡ä¾¿å¸¦å¤§å®¶äº†è§£å¦‚ä½•æ–¹ä¾¿ã€æé€Ÿæ‰©å……ä¸€ä¸ª Apache DolphinScheduler Taskã€‚</p>
<h2>ä½œè€…ç®€ä»‹</h2>
<div align=center>
<img src="/img/2022-03-29/2.jpeg"/>
</div>
<p>å¼ æŸå¼ºï¼Œå¤§æ•°æ®å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸»è¦ç ”ç©¶æ–¹å‘ä¸ºå®æ—¶è®¡ç®—ã€å…ƒæ•°æ®æ²»ç†ã€å¤§æ•°æ®åŸºç¡€ç»„ä»¶ã€‚</p>
<h2><strong>1 ä»€ä¹ˆæ˜¯ SPI æœåŠ¡å‘ç°(What is SPI)ï¼Ÿ</strong></h2>
<p>SPI å…¨ç§°ä¸º (Service Provider Interface) ï¼Œæ˜¯ JDK å†…ç½®çš„ä¸€ç§æœåŠ¡æä¾›å‘ç°æœºåˆ¶ã€‚å¤§å¤šæ•°äººå¯èƒ½ä¼šå¾ˆå°‘ç”¨åˆ°å®ƒï¼Œå› ä¸ºå®ƒçš„å®šä½ä¸»è¦æ˜¯é¢å‘å¼€å‘å‚å•†çš„ï¼Œåœ¨ java.util.ServiceLoader çš„æ–‡æ¡£é‡Œæœ‰æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œå…¶æŠ½è±¡çš„æ¦‚å¿µæ˜¯æŒ‡åŠ¨æ€åŠ è½½æŸä¸ªæœåŠ¡å®ç°ã€‚</p>
<h2><strong>2 ä¸ºä»€ä¹ˆè¦å¼•å…¥ SPI(Why did we introduce SPI)?</strong></h2>
<p>ä¸åŒçš„ä¼ä¸šå¯èƒ½ä¼šæœ‰è‡ªå·±çš„ç»„ä»¶éœ€è¦é€šè¿‡ task å»æ‰§è¡Œï¼Œå¤§æ•°æ®ç”Ÿæ€ä¸­æœ€ä¸ºå¸¸ç”¨æ•°ä»“å·¥å…· Apache Hive æ¥ä¸¾ä¾‹ï¼Œä¸åŒçš„ä¼ä¸šä½¿ç”¨ Hive æ–¹æ³•å„æœ‰ä¸åŒã€‚æœ‰çš„ä¼ä¸šé€šè¿‡ HiveServer2 æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰çš„ä¼ä¸šä½¿ç”¨ HiveClient æ‰§è¡Œä»»åŠ¡ï¼Œè€Œ Apache DolphinScheduler æä¾›çš„å¼€ç®±å³ç”¨çš„ Task ä¸­å¹¶æ²¡æœ‰æ”¯æŒ HiveClient çš„ Taskï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†ä½¿ç”¨è€…éƒ½ä¼šé€šè¿‡ Shell å»æ‰§è¡Œã€‚ç„¶è€Œï¼ŒShell å“ªæœ‰å¤©ç„¶çš„TaskTemplate å¥½ç”¨å‘¢ï¼Ÿæ‰€ä»¥ï¼ŒApache DolphinScheduler ä¸ºäº†ä½¿ç”¨æˆ·èƒ½å¤Ÿæ›´å¥½åœ°æ ¹æ®ä¼ä¸šéœ€æ±‚å®šåˆ¶ä¸åŒçš„ Taskï¼Œä¾¿æ”¯æŒäº† TaskSPI åŒ–ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆè¦äº†è§£ä¸€ä¸‹ Apache DolphinScheduler çš„ Task æ”¹ç‰ˆå†ç¨‹ï¼Œåœ¨ DS 1.3.x æ—¶ï¼Œæ‰©å……ä¸€ä¸ª Task éœ€è¦é‡æ–°ç¼–è¯‘æ•´ä¸ª Apache DolphinSchedulerï¼Œè€¦åˆä¸¥é‡ï¼Œæ‰€ä»¥åœ¨ Apache DolphinScheduler 2.0.x å¼•å…¥äº† SPIã€‚å‰é¢æˆ‘ä»¬æåˆ°äº† SPI çš„æŠ½è±¡æ¦‚å¿µæ˜¯åŠ¨æ€åŠ è½½æŸä¸ªæœåŠ¡çš„å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬å…·è±¡ä¸€ç‚¹ï¼Œå°† Apache DolphinScheduler çš„ Task çœ‹æˆä¸€ä¸ªæ‰§è¡ŒæœåŠ¡ï¼Œè€Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä½¿ç”¨è€…çš„é€‰æ‹©å»æ‰§è¡Œä¸åŒçš„æœåŠ¡ï¼Œå¦‚æœæ²¡æœ‰çš„æœåŠ¡ï¼Œåˆ™éœ€è¦æˆ‘ä»¬è‡ªå·±æ‰©å……ï¼Œç›¸æ¯”äº 1.3.x æˆ‘ä»¬åªéœ€è¦å®Œæˆæˆ‘ä»¬çš„ Task å…·ä½“å®ç°é€»è¾‘ï¼Œç„¶åéµå®ˆ SPI çš„è§„åˆ™ï¼Œç¼–è¯‘æˆ Jar å¹¶ä¸Šä¼ åˆ°æŒ‡å®šç›®å½•ï¼Œå³å¯ä½¿ç”¨æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ Taskã€‚</p>
<h2><strong>3 è°åœ¨ä½¿ç”¨å®ƒ(Who is using it)?</strong></h2>
<p>1ã€Apache DolphinScheduler</p>
<ul>
<li>
<p>task</p>
</li>
<li>
<p>datasource
2ã€Apache Flink</p>
</li>
<li>
<p>flink sql connectorï¼Œç”¨æˆ·å®ç°äº†ä¸€ä¸ªflink-connectoråï¼ŒFlinkä¹Ÿæ˜¯é€šè¿‡SPIæ¥åŠ¨æ€åŠ è½½çš„
3ã€Spring boot</p>
</li>
<li>
<p>spring boot spi
4ã€Jdbc</p>
</li>
<li>
<p>jdbc4ã€‚0ä»¥å‰ï¼Œ å¼€å‘äººå‘˜è¿˜éœ€è¦åŸºäºClassã€‚forName(&quot;xxx&quot;)çš„æ–¹å¼æ¥è£…è½½é©±åŠ¨ï¼Œjdbc4ä¹ŸåŸºäºspiçš„æœºåˆ¶æ¥å‘ç°é©±åŠ¨æä¾›å•†äº†ï¼Œå¯ä»¥é€šè¿‡META-INF/services/javaã€‚sqlã€‚Driveræ–‡ä»¶é‡ŒæŒ‡å®šå®ç°ç±»çš„æ–¹å¼æ¥æš´éœ²é©±åŠ¨æä¾›è€…
5ã€æ›´å¤š</p>
</li>
<li>
<p>dubbo</p>
</li>
<li>
<p>common-logging</p>
</li>
</ul>
<h2><strong>4 Apache DolphinScheduler SPI Process?</strong></h2>
<div align=center>
<img src="/img/2022-03-29/3.png"/>
</div>
<p>å‰–æä¸€ä¸‹ä¸Šé¢è¿™å¼ å›¾ï¼Œæˆ‘ç»™ Apache DolphinScheduler åˆ†ä¸ºé€»è¾‘ Task ä»¥åŠç‰©ç† Taskï¼Œé€»è¾‘ Task æŒ‡ DependTaskï¼ŒSwitchTask è¿™ç§é€»è¾‘ä¸Šçš„ Taskï¼›ç‰©ç† Task æ˜¯æŒ‡ ShellTaskï¼ŒSQLTask è¿™ç§æ‰§è¡Œä»»åŠ¡çš„ Taskã€‚è€Œåœ¨ Apache DolphinSchedulerä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ‰©å……çš„éƒ½æ˜¯ç‰©ç† Taskï¼Œè€Œç‰©ç† Task éƒ½æ˜¯äº¤ç”± Worker å»æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ˜ç™½çš„æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨æœ‰å¤šå° Worker çš„æƒ…å†µä¸‹ï¼Œè¦å°†è‡ªå®šä¹‰çš„ Task åˆ†å‘åˆ°æ¯ä¸€å°æœ‰ Worker çš„æœºå™¨ä¸Šï¼Œå½“æˆ‘ä»¬å¯åŠ¨ Worker æœåŠ¡æ—¶ï¼Œworker ä¼šå»å¯åŠ¨ä¸€ä¸ª ClassLoader æ¥åŠ è½½ç›¸åº”çš„å®ç°äº†è§„åˆ™çš„ Task libï¼Œå¯ä»¥çœ‹åˆ° HiveClient å’Œ SeatunnelTask éƒ½æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œä½†æ˜¯åªæœ‰ HiveTask è¢« Apache DolphinScheduler TaskPluginManage åŠ è½½äº†ï¼ŒåŸå› æ˜¯ SeatunnelTask å¹¶æ²¡æœ‰å»éµå®ˆ SPI çš„è§„åˆ™ã€‚SPI çš„è§„åˆ™å›¾ä¸Šä¹Ÿæœ‰èµ˜è¿°ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ java.util.ServiceLoader è¿™ä¸ªç±»ï¼Œä¸‹é¢æœ‰ä¸€ä¸ªç®€å•çš„å‚è€ƒ(æ‘˜å‡ºçš„ä¸€éƒ¨åˆ†ä»£ç ï¼Œå…·ä½“å¯ä»¥è‡ªå·±å»çœ‹çœ‹ï¼‰</p>
<pre><code class="language-plain">publicÂ finalÂ classÂ ServiceLoader&lt;S&gt;Â implementsÂ Iterable&lt;S&gt;Â {
Â Â Â Â //scanningÂ dirÂ prefix
Â Â Â Â privateÂ staticÂ finalÂ StringÂ PREFIXÂ =Â &quot;META-INF/services/&quot;;

Â Â Â Â //TheÂ classÂ orÂ interfaceÂ representingÂ theÂ serviceÂ beingÂ loaded
Â Â Â Â privateÂ finalÂ Class&lt;S&gt;Â service;

Â Â Â Â //TheÂ classÂ loaderÂ usedÂ toÂ locate,Â load,Â andÂ instantiateÂ providers
Â Â Â Â privateÂ finalÂ ClassLoaderÂ loader;

Â Â Â Â //PrivateÂ innerÂ classÂ implementingÂ fully-lazyÂ providerÂ lookup
Â Â Â Â privateÂ classÂ LazyIteratorÂ implementsÂ Iterator&lt;S&gt;Â {
Â Â Â Â Â Â Â Â Class&lt;S&gt;Â service;
Â Â Â Â Â Â Â Â ClassLoaderÂ loader;
Â Â Â Â Â Â Â Â Enumeration&lt;URL&gt;Â configsÂ =Â null;
Â Â Â Â Â Â Â Â StringÂ nextNameÂ =Â null;

Â Â Â Â Â Â Â Â //......
Â Â Â Â Â Â Â Â privateÂ booleanÂ hasNextService()Â {
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (configsÂ ==Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //getÂ dirÂ allÂ class
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ fullNameÂ =Â PREFIXÂ +Â service.getName();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (loaderÂ ==Â null)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â configsÂ =Â ClassLoader.getSystemResources(fullName);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â else
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â configsÂ =Â loader.getResources(fullName);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (IOExceptionÂ x)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //......
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //......
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}

</code></pre>
<h2><strong>5 å¦‚ä½•æ‰©å±•ä¸€ä¸ª data sourceTask or DataSource (How to extend a task or datasource)?</strong></h2>
<h3><strong>5.1 åˆ›å»º Maven é¡¹ç›®</strong></h3>
<pre><code class="language-plain">
mvnÂ archetype:generateÂ \
Â Â Â Â -DarchetypeGroupId=org.apache.dolphinschedulerÂ \
Â Â Â Â -DarchetypeArtifactId=dolphinscheduler-hive-client-taskÂ \
Â Â Â Â -DarchetypeVersion=1.10.0Â \
Â Â Â Â -DgroupId=org.apache.dolphinschedulerÂ \
Â Â Â Â -DartifactId=dolphinscheduler-hive-client-taskÂ \
Â Â Â Â -Dversion=0.1Â \
Â Â Â Â -Dpackage=org.apache.dolphinschedulerÂ \
Â Â Â Â -DinteractiveMode=falseÂ 
Â Â Â Â 
Â Â Â Â 
</code></pre>
<h3><strong>5.2 Maven ä¾èµ–</strong></h3>
<pre><code class="language-plain">
Â &lt;!--dolphinschedulerÂ spiÂ basicÂ coreÂ denpendence--&gt;
Â &lt;dependency&gt;
Â Â Â Â Â &lt;groupId&gt;org.apache.dolphinscheduler&lt;/groupId&gt;
Â Â Â Â Â &lt;artifactId&gt;dolphinscheduler-spi&lt;/artifactId&gt;
Â Â Â Â Â &lt;version&gt;${dolphinscheduler.lib.version}&lt;/version&gt;
Â Â Â Â Â &lt;scope&gt;${common.lib.scope}&lt;/scope&gt;
Â &lt;/dependency&gt;
Â &lt;dependency&gt;
Â Â Â Â Â &lt;groupId&gt;org.apache.dolphinscheduler&lt;/groupId&gt;
Â Â Â Â Â &lt;artifactId&gt;dolphinscheduler-task-api&lt;/artifactId&gt;
Â Â Â Â Â &lt;version&gt;${dolphinscheduler.lib.version}&lt;/version&gt;
Â Â Â Â Â &lt;scope&gt;${common.lib.scope}&lt;/scope&gt;
Â &lt;/dependency&gt;
Â Â Â Â 
Â Â Â Â 
</code></pre>
<h3><strong>5.3 åˆ›å»º Task é€šé“å·¥å‚(TaskChannelFactory)</strong></h3>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä»»åŠ¡æœåŠ¡çš„å·¥å‚ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¸®åŠ©æ„å»º TaskChannel ä»¥åŠ TaskPlugin å‚æ•°ï¼ŒåŒæ—¶ç»™å‡ºè¯¥ä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼ŒChannelFactory åœ¨ Apache DolphinScheduler çš„ Task æœåŠ¡ç»„ä¸­ï¼Œå…¶ä½œç”¨å±äºæ˜¯åœ¨ä»»åŠ¡ç»„ä¸­çš„æ‰¿ä¸Šå¯ä¸‹ï¼Œäº¤äº’å‰åç«¯ä»¥åŠå¸®åŠ© Worker æ„å»º TaskChannelã€‚</p>
<pre><code class="language-plain">packageÂ org.apache.dolphinscheduler.plugin.task.hive;

importÂ org.apache.dolphinscheduler.spi.params.base.PluginParams;
importÂ org.apache.dolphinscheduler.spi.task.TaskChannel;
importÂ org.apache.dolphinscheduler.spi.task.TaskChannelFactory;

importÂ java.util.List;

publicÂ classÂ HiveClientTaskChannelFactoryÂ implementsÂ TaskChannelFactoryÂ {
Â Â Â Â /**
Â Â Â Â Â *Â Â åˆ›å»ºä»»åŠ¡é€šé“,åŸºäºè¯¥é€šé“æ‰§è¡Œä»»åŠ¡
Â Â Â Â Â *Â @returnÂ ä»»åŠ¡é€šé“
Â Â Â Â Â */
Â Â Â Â @Override
Â Â Â Â publicÂ TaskChannelÂ create()Â {
Â Â Â Â Â Â Â Â returnÂ newÂ HiveClientTaskChannel();
Â Â Â Â }

Â Â Â Â /**
Â Â Â Â Â *Â Â è¿”å›å½“å‰ä»»åŠ¡çš„å…¨å±€å”¯ä¸€æ ‡è¯†
Â Â Â Â Â *Â @returnÂ ä»»åŠ¡ç±»å‹åç§°
Â Â Â Â Â */
Â Â Â Â @Override
Â Â Â Â publicÂ StringÂ getName()Â {
Â Â Â Â Â Â Â Â returnÂ &quot;HIVEÂ CLIENT&quot;;
Â Â Â Â }

Â Â Â Â /**
Â Â Â Â Â *Â å‰ç«¯é¡µé¢éœ€è¦ç”¨åˆ°çš„æ¸²æŸ“,ä¸»è¦åˆ†ä¸º
Â Â Â Â Â 
Â Â Â Â Â *Â @return
Â Â Â Â Â */
Â Â Â Â @Override
Â Â Â Â publicÂ List&lt;PluginParams&gt;Â getParams()Â {
Â Â Â Â Â Â Â Â List&lt;PluginParams&gt;Â pluginParamsÂ =Â newÂ ArrayList&lt;&gt;();
Â Â Â Â Â Â Â Â InputParamÂ nodeNameÂ =Â InputParam.newBuilder(&quot;name&quot;,Â &quot;$t('NodeÂ name')&quot;)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .addValidate(Validate.newBuilder()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setRequired(true)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build())
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build();
Â Â Â Â Â Â Â Â PluginParamsÂ runFlagÂ =Â RadioParam.newBuilder(&quot;runFlag&quot;,Â &quot;RUN_FLAG&quot;)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .addParamsOptions(newÂ ParamsOptions(&quot;NORMAL&quot;,Â &quot;NORMAL&quot;,Â false))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .addParamsOptions(newÂ ParamsOptions(&quot;FORBIDDEN&quot;,Â &quot;FORBIDDEN&quot;,Â false))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build();

Â Â Â Â Â Â Â Â PluginParamsÂ buildÂ =Â CheckboxParam.newBuilder(&quot;HiveÂ SQL&quot;,Â &quot;TestÂ HiveSQL&quot;)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setDisplay(true)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setValue(&quot;--Â author:Â \nÂ --desc:&quot;)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build();

Â Â Â Â Â Â Â Â pluginParams.add(nodeName);
Â Â Â Â Â Â Â Â pluginParams.add(runFlag);
Â Â Â Â Â Â Â Â pluginParams.add(build);

Â Â Â Â Â Â Â Â returnÂ pluginParams;
Â Â Â Â }
}
</code></pre>
<h3><strong>5.4 åˆ›å»º TaskChannel</strong></h3>
<p>æœ‰äº†å·¥å‚ä¹‹åï¼Œæˆ‘ä»¬ä¼šæ ¹æ®å·¥å‚åˆ›å»ºå‡º TaskChannelï¼ŒTaskChannel åŒ…å«å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å–æ¶ˆï¼Œä¸€ä¸ªæ˜¯åˆ›å»ºï¼Œç›®å‰ä¸éœ€è¦å…³æ³¨å–æ¶ˆï¼Œä¸»è¦å…³æ³¨åˆ›å»ºä»»åŠ¡ã€‚</p>
<pre><code class="language-plain">Â Â Â Â voidÂ cancelApplication(booleanÂ status);

Â Â Â Â /**
Â Â Â Â Â *Â æ„å»ºå¯æ‰§è¡Œä»»åŠ¡
Â Â Â Â Â */
Â Â Â Â AbstractTaskÂ createTask(TaskRequestÂ taskRequest);
Â Â Â Â publicÂ classÂ HiveClientTaskChannelÂ implementsÂ TaskChannelÂ {
Â Â Â Â @Override
Â Â Â Â publicÂ voidÂ cancelApplication(booleanÂ b)Â {
Â Â Â Â Â Â Â Â //doÂ nothing
Â Â Â Â }

Â Â Â Â @Override
Â Â Â Â publicÂ AbstractTaskÂ createTask(TaskRequestÂ taskRequest)Â {
Â Â Â Â Â Â Â Â returnÂ newÂ HiveClientTask(taskRequest);
Â Â Â Â }
}

</code></pre>
<h3><strong>5.5 æ„å»º Task å®ç°</strong></h3>
<p>é€šè¿‡ TaskChannel æˆ‘ä»¬å¾—åˆ°äº†å¯æ‰§è¡Œçš„ç‰©ç† Taskï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ç»™å½“å‰ Task æ·»åŠ ç›¸åº”çš„å®ç°ï¼Œæ‰èƒ½å¤Ÿè®©Apache DolphinScheduler å»æ‰§è¡Œä½ çš„ä»»åŠ¡ï¼Œé¦–å…ˆåœ¨ç¼–å†™ Task ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ Task ä¹‹é—´çš„å…³ç³»ï¼š</p>
<div align=center>
<img src="/img/2022-03-29/4.png"/>
</div>
<p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŸºäº Yarn æ‰§è¡Œä»»åŠ¡çš„ Task éƒ½ä¼šå»ç»§æ‰¿ AbstractYarnTaskï¼Œä¸éœ€è¦ç»è¿‡ Yarn æ‰§è¡Œçš„éƒ½ä¼šå»ç›´æ¥ç»§æ‰¿ AbstractTaskExecutorï¼Œä¸»è¦æ˜¯åŒ…å«ä¸€ä¸ª AppIDï¼Œä»¥åŠ CanalApplication setMainJar ä¹‹ç±»çš„æ–¹æ³•ï¼Œæƒ³çŸ¥é“çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±å»æ·±å…¥ç ”ç©¶ä¸€ä¸‹ï¼Œå¦‚ä¸Šå¯çŸ¥æˆ‘ä»¬å®ç°çš„ HiveClient å°±éœ€è¦ç»§æ‰¿ AbstractYarnTaskï¼Œåœ¨æ„å»º Task ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸‹é€‚é… HiveClient çš„ Parameters å¯¹è±¡ç”¨æ¥ååºåˆ—åŒ–JsonParamã€‚</p>
<pre><code class="language-plain">Â Â packageÂ com.jegger.dolphinscheduler.plugin.task.hive;

importÂ org.apache.dolphinscheduler.spi.task.AbstractParameters;
importÂ org.apache.dolphinscheduler.spi.task.ResourceInfo;

importÂ java.util.List;

publicÂ classÂ HiveClientParametersÂ extendsÂ AbstractParametersÂ {
Â Â Â Â /**
Â Â Â Â Â *Â ç”¨HiveClientæ‰§è¡Œ,æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å°†æ‰€æœ‰SQLå…¨éƒ¨è´´è¿›å»å³å¯,æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªSQLå‚æ•°
Â Â Â Â Â */
Â Â Â Â privateÂ StringÂ sql;

Â Â Â Â publicÂ StringÂ getSql()Â {
Â Â Â Â Â Â Â Â returnÂ sql;
Â Â Â Â }

Â Â Â Â publicÂ voidÂ setSql(StringÂ sql)Â {
Â Â Â Â Â Â Â Â this.sqlÂ =Â sql;
Â Â Â Â }

Â Â Â Â @Override
Â Â Â Â publicÂ booleanÂ checkParameters()Â {
Â Â Â Â Â Â Â Â returnÂ sqlÂ !=Â null;
Â Â Â Â }

Â Â Â Â @Override
Â Â Â Â publicÂ List&lt;ResourceInfo&gt;Â getResourceFilesList()Â {
Â Â Â Â Â Â Â Â returnÂ null;
Â Â Â Â }
}

</code></pre>
<p>å®ç°äº† Parameters å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬å…·ä½“å®ç° Taskï¼Œä¾‹å­ä¸­çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†ç”¨æˆ·çš„å‚æ•°å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ Hive -f å»æ‰§è¡Œä»»åŠ¡ã€‚</p>
<pre><code class="language-plain">Â packageÂ org.apache.dolphinscheduler.plugin.task.hive;

importÂ org.apache.dolphinscheduler.plugin.task.api.AbstractYarnTask;
importÂ org.apache.dolphinscheduler.spi.task.AbstractParameters;
importÂ org.apache.dolphinscheduler.spi.task.request.TaskRequest;
importÂ org.apache.dolphinscheduler.spi.utils.JSONUtils;

importÂ java.io.BufferedWriter;
importÂ java.io.IOException;
importÂ java.nio.charset.StandardCharsets;
importÂ java.nio.file.Files;
importÂ java.nio.file.Path;
importÂ java.nio.file.Paths;



publicÂ classÂ HiveClientTaskÂ extendsÂ AbstractYarnTaskÂ {

Â Â Â Â /**
Â Â Â Â Â *Â hiveÂ clientÂ parameters
Â Â Â Â Â */
Â Â Â Â privateÂ HiveClientParametersÂ hiveClientParameters;

Â Â Â Â /**
Â Â Â Â Â *Â taskExecutionContext
Â Â Â Â Â */
Â Â Â Â privateÂ finalÂ TaskRequestÂ taskExecutionContext;



Â Â Â Â publicÂ HiveClientTask(TaskRequestÂ taskRequest)Â {
Â Â Â Â Â Â Â Â super(taskRequest);
Â Â Â Â Â Â Â Â this.taskExecutionContextÂ =Â taskRequest;
Â Â Â Â }

Â Â Â Â /**
Â Â Â Â Â *Â taskÂ initÂ method
Â Â Â Â Â */
Â Â Â Â @Override
Â Â Â Â publicÂ voidÂ init()Â {
Â Â Â Â Â Â Â Â logger.info(&quot;hiveÂ clientÂ taskÂ paramÂ isÂ {}&quot;,Â JSONUtils.toJsonString(taskExecutionContext));
Â Â Â Â Â Â Â Â this.hiveClientParametersÂ =Â JSONUtils.parseObject(taskExecutionContext.getTaskParams(),Â HiveClientParameters.class);

Â Â Â Â Â Â Â Â ifÂ (this.hiveClientParametersÂ !=Â nullÂ &amp;&amp;Â !hiveClientParameters.checkParameters())Â {
Â Â Â Â Â Â Â Â Â Â Â Â throwÂ newÂ RuntimeException(&quot;hiveÂ clientÂ taskÂ paramsÂ isÂ notÂ valid&quot;);
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â /**
Â Â Â Â Â *Â buildÂ taskÂ executionÂ command
Â Â Â Â Â *
Â Â Â Â Â *Â @returnÂ taskÂ executionÂ commandÂ orÂ null
Â Â Â Â Â */
Â Â Â Â @Override
Â Â Â Â protectedÂ StringÂ buildCommand()Â {
Â Â Â Â Â Â Â Â StringÂ filePathÂ =Â getFilePath();
Â Â Â Â Â Â Â Â ifÂ (writeExecutionContentToFile(filePath))Â {
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ &quot;hiveÂ -fÂ &quot;Â +Â filePath;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â returnÂ null;
Â Â Â Â }

Â Â Â Â /**
Â Â Â Â Â *Â getÂ hiveÂ sqlÂ writeÂ path
Â Â Â Â Â *
Â Â Â Â Â *Â @returnÂ fileÂ writeÂ path
Â Â Â Â Â */
Â Â Â Â privateÂ StringÂ getFilePath()Â {
Â Â Â Â Â Â Â Â returnÂ String.format(&quot;%s/hive-%s-%s.sql&quot;,Â this.taskExecutionContext.getExecutePath(),Â this.taskExecutionContext.getTaskName(),Â this.taskExecutionContext.getTaskInstanceId());
Â Â Â Â }

Â Â Â Â @Override
Â Â Â Â protectedÂ voidÂ setMainJarName()Â {
Â Â Â Â Â Â Â Â //doÂ nothing
Â Â Â Â }

Â Â Â Â /**
Â Â Â Â Â *Â writeÂ hiveÂ sqlÂ toÂ filepath
Â Â Â Â Â *
Â Â Â Â Â *Â @paramÂ filePathÂ fileÂ path
Â Â Â Â Â *Â @returnÂ writeÂ success?
Â Â Â Â Â */
Â Â Â Â privateÂ booleanÂ writeExecutionContentToFile(StringÂ filePath)Â {
Â Â Â Â Â Â Â Â PathÂ pathÂ =Â Paths.get(filePath);
Â Â Â Â Â Â Â Â tryÂ (BufferedWriterÂ writerÂ =Â Files.newBufferedWriter(path,Â StandardCharsets.UTF_8))Â {
Â Â Â Â Â Â Â Â Â Â Â Â writer.write(this.hiveClientParameters.getSql());
Â Â Â Â Â Â Â Â Â Â Â Â logger.info(&quot;file:&quot;Â +Â filePathÂ +Â &quot;writeÂ success.&quot;);
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true;
Â Â Â Â Â Â Â Â }Â catchÂ (IOExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Â Â Â Â logger.error(&quot;file:&quot;Â +Â filePathÂ +Â &quot;writeÂ failed.pleaseÂ pathÂ auth.&quot;);
Â Â Â Â Â Â Â Â Â Â Â Â e.printStackTrace();
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false;
Â Â Â Â Â Â Â Â }

Â Â Â Â }

Â Â Â Â @Override
Â Â Â Â publicÂ AbstractParametersÂ getParameters()Â {
Â Â Â Â Â Â Â Â returnÂ this.hiveClientParameters;
Â Â Â Â }
}

</code></pre>
<h4><strong>5.6 éµå®ˆ SPI è§„åˆ™</strong></h4>
<pre><code class="language-plain">Â #Â 1,Resourceä¸‹åˆ›å»ºMETA-INF/servicesæ–‡ä»¶å¤¹,åˆ›å»ºæ¥å£å…¨ç±»åç›¸åŒçš„æ–‡ä»¶
zhang@xiaozhangÂ resourcesÂ %Â treeÂ ./
./
â””â”€â”€Â META-INF
Â Â Â Â â””â”€â”€Â services
Â Â Â Â Â Â Â Â â””â”€â”€Â org.apache.dolphinscheduler.spi.task.TaskChannelFactory
#Â 2,åœ¨æ–‡ä»¶ä¸­å†™å…¥å®ç°ç±»çš„å…¨é™å®šç±»å
zhang@xiaozhangÂ resourcesÂ %Â moreÂ META-INF/services/org.apache.dolphinscheduler.spi.task.TaskChannelFactoryÂ 
org.apache.dolphinscheduler.plugin.task.hive.HiveClientTaskChannelFactory

</code></pre>
<h4><strong>5.7 æ‰“åŒ…å’Œéƒ¨ç½²</strong></h4>
<pre><code class="language-plain">##Â 1,æ‰“åŒ…
mvnÂ cleanÂ install
##Â 2,éƒ¨ç½²
cpÂ ./target/dolphinscheduler-task-hiveclient-1.0.jarÂ $DOLPHINSCHEDULER_HOME/lib/
##Â 3,restartÂ dolphinschedulerÂ server

</code></pre>
<p>ä»¥ä¸Šæ“ä½œå®Œæˆåï¼Œæˆ‘ä»¬æŸ¥çœ‹ worker æ—¥å¿— tail -200f $Apache DolphinScheduler_HOME/log/Apache DolphinScheduler-worker.log</p>
<div align=center>
<img src="/img/2022-03-29/5.png"/>
</div>
<p>Apache DolphinScheduler çš„æ’ä»¶å¼€å‘å°±åˆ°æ­¤å®Œæˆ~æ¶‰åŠåˆ°å‰ç«¯çš„ä¿®æ”¹å¯ä»¥å‚è€ƒï¼š</p>
<p>Apache DolphinScheduler-ui/src/js/conf/home/pages/dag/_source/formModel/</p>
</section><footer class="footer-container"><div class="footer-body"><div><h3>è”ç³»æˆ‘ä»¬</h3><h4>æœ‰é—®é¢˜éœ€è¦åé¦ˆï¼Ÿè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ã€‚</h4></div><div class="contact-container"><ul><li><a href="/zh-cn/community/development/subscribe.html"><img class="img-base" src="/img/emailgray.png"/><img class="img-change" src="/img/emailblue.png"/><p>é‚®ä»¶åˆ—è¡¨</p></a></li><li><a href="https://twitter.com/dolphinschedule"><img class="img-base" src="/img/twittergray.png"/><img class="img-change" src="/img/twitterblue.png"/><p>Twitter</p></a></li><li><a href="https://stackoverflow.com/questions/tagged/apache-dolphinscheduler"><img class="img-base" src="/img/stackoverflow.png"/><img class="img-change" src="/img/stackoverflow-selected.png"/><p>Stack Overflow</p></a></li><li><a href="https://s.apache.org/dolphinscheduler-slack"><img class="img-base" src="/img/slack.png"/><img class="img-change" src="/img/slack-selected.png"/><p>Slack</p></a></li></ul></div><div class="cols-container"><div class="docu-container"><h4>æ–‡æ¡£</h4><ul><li><a href="/zh-cn/development/architecture-design.html"><p>æ¦‚è§ˆ</p></a></li><li><a href="/zh-cn/docs/latest/user_doc/guide/quick-start.html"><p>å¿«é€Ÿå¼€å§‹</p></a></li><li><a href="/zh-cn/development/development-environment-setup.html"><p>å¼€å‘è€…æŒ‡å—</p></a></li></ul></div><div></div><div class="asf-container"><h4>ASF</h4><ul><li><a href="http://www.apache.org"><p>åŸºé‡‘ä¼š</p></a></li><li><a href="http://www.apache.org/licenses/"><p>è¯ä¹¦</p></a></li><li><a href="http://www.apache.org/events/current-event"><p>äº‹ä»¶</p></a></li><li><a href="http://www.apache.org/foundation/sponsorship.html"><p>èµåŠ©</p></a></li><li><a href="http://www.apache.org/foundation/thanks.html"><p>è‡´è°¢</p></a></li></ul></div></div><div class="copyright"><span>Copyright Â© 2019-2021 The Apache Software Foundation. Apache DolphinScheduler, DolphinScheduler, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
  <script src="/asset/js/react/react-with-addons.min.js"></script>
  <script src="/asset/js/react/react-dom.min.js"></script>
  <script>window.rootPath = '';</script>
  <script src="/build/vendor.a476297.js"></script>
  <script src="/build/blog.md.f25cabd.js"></script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d6bc736fd9885d9a5dc938425ac062ad";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-899J8PYKJZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-899J8PYKJZ');
  </script>
</body>
</html>