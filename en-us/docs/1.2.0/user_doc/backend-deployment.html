<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="keywords" content="backend-deployment">
  <meta name="description" content="backend-deployment">
  <title>backend-deployment</title>
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/build/vendor.23870e5.css">
</head>
<body>
  <div id="root"><div class="md2html docs-page" data-reactroot=""><header class="header-container header-container-dark"><div class="header-body"><span class="mobile-menu-btn mobile-menu-btn-dark"></span><a href="/en-us/index.html"><img class="logo" src="/img/hlogo_white.svg"/></a><div class="search search-dark"><span class="icon-search"></span></div><span class="language-switch language-switch-dark">中</span><div class="header-menu"><div><ul class="ant-menu whiteClass ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/index.html" target="_self">HOME</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-item-selected" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="/en-us/docs/latest/user_doc/guide/quick-start.html" target="_self">DOCS</a></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/download/download.html" target="_self">DOWNLOAD</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/blog/index.html" target="_self">BLOG</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/development/development-environment-setup.html" target="_self">DEVELOPMENT</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/community/team.html" target="_self">COMMUNITY</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span class="submenu-title-wrapper"><a href="https://www.apache.org/" target="_blank">ASF</a></span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li class="ant-menu-item" role="menuitem"><a href="/en-us/user/index.html" target="_self">USER</a></li><li class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute" role="menuitem"><div class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul></div></div><div class="mobile-menu"><div class="mobile-menu-content"><div class="mobile-menu-list"><div class="mobile-menu-item"><a class="mobile-menu-title" href="/en-us/index.html" target="_self">HOME</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/en-us/docs/latest/user_doc/guide/quick-start.html" target="_self">DOCS</a><em class="mobile-menu-icon"></em><div class="mobile-sub-menus"><div class="mobile-sub-menu-item"><a href="/en-us/docs/latest/user_doc/guide/quick-start.html" target="_self">latest(2.0.5)</a></div><div class="mobile-sub-menu-item"><a href="/en-us/docs/1.3.9/user_doc/quick-start.html" target="_self">1.3.9</a></div><div class="mobile-sub-menu-item"><a href="/en-us/docs/release/history-versions.html" target="_self">Older Versions</a></div><div class="mobile-sub-menu-item"><a href="/python/index.html" target="_self">PyDolphinScheduler</a></div><div class="mobile-sub-menu-item"><a href="/en-us/docs/dev/user_doc/about/introduction.html" target="_self">dev</a></div></div></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/en-us/download/download.html" target="_self">DOWNLOAD</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/en-us/blog/index.html" target="_self">BLOG</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/en-us/development/development-environment-setup.html" target="_self">DEVELOPMENT</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/en-us/community/team.html" target="_self">COMMUNITY</a></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="https://www.apache.org/" target="_blank">ASF</a><em class="mobile-menu-icon"></em><div class="mobile-sub-menus"><div class="mobile-sub-menu-item"><a href="https://www.apache.org/" target="_blank">Foundation</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/licenses/" target="_blank">License</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/events/current-event" target="_blank">Events</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/security/" target="_blank">Security</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank">Sponsorship</a></div><div class="mobile-sub-menu-item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a></div></div></div><div class="mobile-menu-item"><a class="mobile-menu-title" href="/en-us/user/index.html" target="_self">USER</a></div></div></div><div class="mobile-menu-dummy"></div></div></div></header><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>Deployment Document</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.2.0/user_doc/hardware-environment.html" target="_self">Hardware Environment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.2.0/user_doc/standalone-deployment.html" target="_self">Standalone Deployment</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.2.0/user_doc/cluster-deployment.html" target="_self">Cluster Deployment</a></li></ul></li><li class="menu-item menu-item-level-1"><span>User Manual</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.2.0/user_doc/quick-start.html" target="_self">Quick Start</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.2.0/user_doc/system-manual.html" target="_self">User Manual</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.2.0/user_doc/metadata-1.2.html" target="_self">Metadata</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/1.2.0/user_doc/deployparam.html" target="_self">Deploy Param</a></li></ul></li><li class="menu-item menu-item-level-1"><span>Upgrade</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/1.2.0/user_doc/upgrade.html" target="_self">Upgrade</a></li></ul></li><li class="menu-item menu-item-level-1"><span>FAQ</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/en-us/docs/release/faq.html" target="_self">FAQ</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>Backend Deployment Document</h1>
<p>There are two deployment modes for the backend:</p>
<ul>
<li>automatic deployment</li>
<li>source code compile and then deployment</li>
</ul>
<h2>Preparations</h2>
<p>Download the latest version of the installation package, download address：  <a href="/en-us/download/download.html">download</a>,
download apache-dolphinscheduler-incubating-x.x.x-dolphinscheduler-backend-bin.tar.gz</p>
<h4>Preparations 1: Installation of basic software (self-installation of required items)</h4>
<ul>
<li><a href="https://www.postgresql.org/download/">PostgreSQL</a> (8.2.15+) or <a href="https://dev.mysql.com/downloads/mysql/">MySQL</a> (5.5+) : You can choose either PostgreSQL or MySQL.</li>
<li><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK</a> (1.8+) : Mandatory</li>
<li><a href="https://zookeeper.apache.org/releases.html">ZooKeeper</a> (3.4.6+) : Mandatory</li>
<li>pstree or psmisc : &quot;pstree&quot; is required for Mac OS and &quot;psmisc&quot; is required for Fedora/Red/Hat/CentOS/Ubuntu/Debian</li>
<li><a href="https://hadoop.apache.org/releases.html">Hadoop</a> (2.6+) or <a href="https://min.io/download">MinIO</a> : Optionally, if you need to use the resource upload function, You can choose either Hadoop or MinIo.</li>
<li><a href="https://hive.apache.org/downloads.html">Hive</a> (1.2.1) : Optional, hive task submission needs to be installed</li>
<li><a href="http://spark.apache.org/downloads.html">Spark</a> (1.x,2.x) : Optional, Spark task submission needs to be installed</li>
</ul>
<pre><code> Note: DolphinScheduler itself does not rely on Hadoop, Hive, Spark, PostgreSQL, but only calls their Client to run the corresponding tasks.
</code></pre>
<h4>Preparations 2: Create deployment users</h4>
<ul>
<li>Deployment users are created on all machines that require deployment scheduling, because the worker service executes jobs in <code>sudo-u {linux-user}</code>, so deployment users need sudo privileges and are confidential.</li>
</ul>
<pre><code>vi /etc/sudoers

# For example, the deployment user is an dolphinscheduler account
dolphinscheduler  ALL=(ALL)       NOPASSWD: NOPASSWD: ALL

# And you need to comment out the Default requiretty line
#Default requiretty
</code></pre>
<h4>Preparations 3: SSH Secret-Free Configuration</h4>
<p>Configure SSH secret-free login on deployment machines and other installation machines. If you want to install dolphinscheduler on deployment machines, you need to configure native password-free login itself.</p>
<ul>
<li>Connect the host and other machines SSH</li>
</ul>
<h4>Preparations 4: database initialization</h4>
<ul>
<li>
<p>Create databases and accounts</p>
<p>Execute the following command to create database and account</p>
<pre><code>CREATE DATABASE dolphinscheduler DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL PRIVILEGES ON dolphinscheduler.* TO '{user}'@'%' IDENTIFIED BY '{password}';
GRANT ALL PRIVILEGES ON dolphinscheduler.* TO '{user}'@'localhost' IDENTIFIED BY '{password}';
flush privileges;
</code></pre>
</li>
<li>
<p>creates tables and imports basic data
Modify the following attributes in ./conf/application-dao.properties</p>
<pre><code>    spring.datasource.url
    spring.datasource.username
    spring.datasource.password
</code></pre>
<p>Execute scripts for creating tables and importing basic data</p>
<pre><code>sh ./script/create-dolphinscheduler.sh
</code></pre>
</li>
</ul>
<h4>Preparations 5: Modify the deployment directory permissions and operation parameters</h4>
<pre><code> instruction of dolphinscheduler-backend directory 
</code></pre>
<pre><code class="language-directory">bin : Basic service startup script
DISCLAIMER-WIP : DISCLAIMER-WIP
conf : Project Profile
lib : The project relies on jar packages, including individual module jars and third-party jars
LICENSE : LICENSE
licenses : licenses
NOTICE : NOTICE
script :  Cluster Start, Stop and Service Monitor Start and Stop scripts
sql : The project relies on SQL files
install.sh :  One-click deployment script
</code></pre>
<ul>
<li>
<p>Modify permissions (please modify the 'deployUser' to the corresponding deployment user) so that the deployment user has operational privileges on the dolphinscheduler-backend directory</p>
<p><code>sudo chown -R deployUser:deployUser dolphinscheduler-backend</code></p>
</li>
<li>
<p>Modify the <code>.dolphinscheduler_env.sh</code> environment variable in the conf/env/directory</p>
</li>
<li>
<p>Modify deployment parameters (depending on your server and business situation):</p>
</li>
<li>
<p>Modify the parameters in <code>install.sh</code> to replace the values required by your business</p>
<ul>
<li>MonitorServerState switch variable, added in version 1.0.3, controls whether to start the self-start script (monitor master, worker status, if off-line will start automatically). The default value of &quot;false&quot; means that the self-start script is not started, and if it needs to start, it is changed to &quot;true&quot;.</li>
<li>'hdfsStartupSate' switch variable controls whether to start hdfs
The default value of &quot;false&quot; means not to start hdfs
Change the variable to 'true' if you want to use hdfs, you also need to create the hdfs root path by yourself, that 'hdfsPath' in <a href="http://install.sh">install.sh</a>.</li>
</ul>
</li>
<li>
<p>If you use hdfs-related functions, you need to copy<strong>hdfs-site.xml</strong> and <strong>core-site.xml</strong> to the conf directory</p>
</li>
</ul>
<h2>Deployment</h2>
<p>Either of the following two methods can be deployed,binary file deployment is recommended, and experienced partners can use source deployment as well.</p>
<h3>Binary file Deployment</h3>
<ul>
<li>
<p>Install ZooKeeper tools</p>
<p><code>pip install kazoo</code></p>
</li>
<li>
<p>Switch to deployment user, one-click deployment</p>
<p><code>sh install.sh</code></p>
</li>
<li>
<p>Use the <code>jps</code> command to check if the services are started (<code>jps</code> comes from <code>Java JDK</code>)</p>
</li>
</ul>
<pre><code class="language-aidl">    MasterServer         ----- Master Service
    WorkerServer         ----- Worker Service
    LoggerServer         ----- Logger Service
    ApiApplicationServer ----- API Service
    AlertServer          ----- Alert Service
</code></pre>
<p>If all services are normal, the automatic deployment is successful</p>
<p>After successful deployment, the log can be viewed and stored in a specified folder.</p>
<pre><code class="language-logPath"> logs/
    ├── dolphinscheduler-alert-server.log
    ├── dolphinscheduler-master-server.log
    |—— dolphinscheduler-worker-server.log
    |—— dolphinscheduler-api-server.log
    |—— dolphinscheduler-logger-server.log
</code></pre>
<h3>Compile source code to deploy</h3>
<p>After downloading the release version of the source package, uncompress it into the root directory</p>
<ul>
<li>
<p>Build a tar package</p>
<p>Execute the compilation command：</p>
<pre><code> mvn -U clean package -Prelease -Dmaven.test.skip=true
</code></pre>
<p>View directory</p>
<p>After normal compilation, <code>apache-dolphinscheduler-incubating-${latest.release.version}-dolphinscheduler-backend-bin.tar.gz</code>
is generated in the <code>./dolphinscheduler-dist/dolphinscheduler-backend/target</code> directory</p>
</li>
<li>
<p>OR build a rpm package</p>
<p>The rpm package can be installed on the Linux platform using the rpm command or yum. The rpm package can be used to help Dolphinscheduler better integrate with other management tools, such as ambari, cloudera manager.</p>
<p>Execute the compilation command：</p>
<pre><code> mvn -U clean package -Prpmbuild -Dmaven.test.skip=true
</code></pre>
<p>View directory</p>
<p>After normal compilation, <code>apache-dolphinscheduler-incubating-${latest.release.version}-1.noarch.rpm</code>
is generated in the <code>./dolphinscheduler-dist/target/rpm/apache-dolphinscheduler-incubating/RPMS/noarch/</code> directory</p>
</li>
<li>
<p>Decompress the compiled tar.gz package or use the rpm command to install (the rpm installation method will install dolphinscheduler in the /opt/soft directory) . The dolphinscheduler directory structure is like this:</p>
<pre><code> ../
    ├── bin
    ├── conf
    |── DISCLAIMER
    |—— install.sh
    |—— lib
    |—— LICENSE
    |—— licenses
    |—— NOTICE
    |—— script
    |—— sql
</code></pre>
</li>
</ul>
<ul>
<li>
<p>Install ZooKeeper tools</p>
<p><code>pip install kazoo</code></p>
</li>
<li>
<p>Switch to deployment user, one-click deployment</p>
<p><code>sh install.sh</code></p>
</li>
</ul>
<h3>Start-and-stop services commonly used in systems (for service purposes, please refer to System Architecture Design for details)</h3>
<ul>
<li>
<p>stop all services in the cluster</p>
<p><code>sh ./bin/stop-all.sh</code></p>
</li>
<li>
<p>start all services in the cluster</p>
<p><code>sh ./bin/start-all.sh</code></p>
</li>
<li>
<p>start and stop one master server</p>
</li>
</ul>
<pre><code class="language-master">sh ./bin/dolphinscheduler-daemon.sh start master-server
sh ./bin/dolphinscheduler-daemon.sh stop master-server
</code></pre>
<ul>
<li>start and stop one worker server</li>
</ul>
<pre><code class="language-worker">sh ./bin/dolphinscheduler-daemon.sh start worker-server
sh ./bin/dolphinscheduler-daemon.sh stop worker-server
</code></pre>
<ul>
<li>start and stop api server</li>
</ul>
<pre><code class="language-Api">sh ./bin/dolphinscheduler-daemon.sh start api-server
sh ./bin/dolphinscheduler-daemon.sh stop api-server
</code></pre>
<ul>
<li>start and stop logger server</li>
</ul>
<pre><code class="language-Logger">sh ./bin/dolphinscheduler-daemon.sh start logger-server
sh ./bin/dolphinscheduler-daemon.sh stop logger-server
</code></pre>
<ul>
<li>start and stop alert server</li>
</ul>
<pre><code class="language-Alert">sh ./bin/dolphinscheduler-daemon.sh start alert-server
sh ./bin/dolphinscheduler-daemon.sh stop alert-server
</code></pre>
<h2>Database Upgrade</h2>
<p>Modify the following properties in ./conf/application-dao.properties</p>
<pre><code>```
    spring.datasource.url
    spring.datasource.username
    spring.datasource.password
```
</code></pre>
<p>The database can be upgraded automatically by executing the following command:</p>
<pre><code class="language-upgrade">sh ./script/upgrade-dolphinscheduler.sh
</code></pre>
</div></section><footer class="footer-container"><div class="footer-body"><div><h3>About us</h3><h4>Do you need feedback? Please contact us through the following ways.</h4></div><div class="contact-container"><ul><li><a href="/en-us/community/development/subscribe.html"><img class="img-base" src="/img/emailgray.png"/><img class="img-change" src="/img/emailblue.png"/><p>Email List</p></a></li><li><a href="https://twitter.com/dolphinschedule"><img class="img-base" src="/img/twittergray.png"/><img class="img-change" src="/img/twitterblue.png"/><p>Twitter</p></a></li><li><a href="https://stackoverflow.com/questions/tagged/apache-dolphinscheduler"><img class="img-base" src="/img/stackoverflow.png"/><img class="img-change" src="/img/stackoverflow-selected.png"/><p>Stack Overflow</p></a></li><li><a href="https://join.slack.com/t/asf-dolphinscheduler/shared_invite/zt-omtdhuio-_JISsxYhiVsltmC5h38yfw"><img class="img-base" src="/img/slack.png"/><img class="img-change" src="/img/slack-selected.png"/><p>Slack</p></a></li></ul></div><div class="cols-container"><div class="docu-container"><h4>Documentation</h4><ul><li><a href="/en-us/development/architecture-design.html"><p>Overview</p></a></li><li><a href="/en-us/docs/latest/user_doc/guide/quick-start.html"><p>Quick start</p></a></li><li><a href="/en-us/development/development-environment-setup.html"><p>Developer guide</p></a></li></ul></div><div></div><div class="asf-container"><h4>ASF</h4><ul><li><a href="http://www.apache.org"><p>Foundation</p></a></li><li><a href="http://www.apache.org/licenses/"><p>License</p></a></li><li><a href="http://www.apache.org/events/current-event"><p>Events</p></a></li><li><a href="http://www.apache.org/foundation/sponsorship.html"><p>Sponsorship</p></a></li><li><a href="http://www.apache.org/foundation/thanks.html"><p>Thanks</p></a></li></ul></div></div><div class="copyright"><span>Copyright © 2019-2021 The Apache Software Foundation. Apache DolphinScheduler, DolphinScheduler, and its feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
  <script src="//cdn.jsdelivr.net/npm/react@15.6.2/dist/react-with-addons.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/react-dom@15.6.2/dist/react-dom.min.js"></script>
  <script>window.rootPath = '';</script>
  <script src="/build/vendor.90dcf97.js"></script>
  <script src="/build/docs.md.8182f21.js"></script>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4e7b4b400dd31fa015018a435c64d06f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-899J8PYKJZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-899J8PYKJZ');
  </script>
</body>
</html>