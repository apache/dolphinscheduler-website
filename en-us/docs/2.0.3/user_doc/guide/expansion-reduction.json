{
  "filename": "expansion-reduction.md",
  "__html": "<!-- markdown-link-check-disable -->\n<h1>DolphinScheduler Expansion and Reduction</h1>\n<h2>Expansion</h2>\n<p>This article describes how to add a new master service or worker service to an existing DolphinScheduler cluster.</p>\n<pre><code> Attention: There cannot be more than one master service process or worker service process on a physical machine.\n       If the physical machine where the expansion master or worker node is located has already installed the scheduled service, skip to [1.4 Modify configuration] Edit the configuration file `conf/config/install_config.conf` on **all ** nodes, add masters or workers parameter, and restart the scheduling cluster.\n</code></pre>\n<h3>Basic Software Installation</h3>\n<ul>\n<li>[required] <a href=\"https://www.oracle.com/technetwork/java/javase/downloads/index.html\">JDK</a> (1.8+):Must be installed, please install and configure JAVA_HOME and PATH variables under /etc/profile</li>\n<li>[optional] If the expansion is a worker node, you need to consider whether to install an external client, such as Hadoop, Hive, Spark Client.</li>\n</ul>\n<pre><code class=\"language-markdown\"> Attention: DolphinScheduler itself does not depend on Hadoop, Hive, Spark, but will only call their Client for the corresponding task submission.\n</code></pre>\n<h3>Get Installation Package</h3>\n<ul>\n<li>Check which version of DolphinScheduler is used in your existing environment, and get the installation package of the corresponding version, if the versions are different, there may be compatibility problems.</li>\n<li>Confirm the unified installation directory of other nodes, this article assumes that DolphinScheduler is installed in /opt/ directory, and the full path is /opt/dolphinscheduler.</li>\n<li>Please download the corresponding version of the installation package to the server installation directory, uncompress it and rename it to dolphinscheduler and store it in the /opt directory.</li>\n<li>Add database dependency package, this article uses Mysql database, add mysql-connector-java driver package to /opt/dolphinscheduler/lib directory.</li>\n</ul>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> create the installation directory, please <span class=\"hljs-keyword\">do</span> not create the installation directory <span class=\"hljs-keyword\">in</span> /root, /home and other high privilege directories</span> \nmkdir -p /opt\ncd /opt\n<span class=\"hljs-meta\">#</span><span class=\"bash\"> decompress</span>\ntar -zxvf apache-dolphinscheduler-2.0.3-bin.tar.gz -C /opt \ncd /opt\nmv apache-dolphinscheduler-2.0.3-bin  dolphinscheduler\n</code></pre>\n<pre><code class=\"language-markdown\"> Attention: The installation package can be copied directly from an existing environment to an expanded physical machine for use.\n</code></pre>\n<h3>Create Deployment Users</h3>\n<ul>\n<li>Create deployment users on <strong>all</strong> expansion machines, and be sure to configure sudo-free. If we plan to deploy scheduling on four expansion machines, ds1, ds2, ds3, and ds4, we first need to create deployment users on each machine</li>\n</ul>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> to create a user, you need to <span class=\"hljs-built_in\">log</span> <span class=\"hljs-keyword\">in</span> with root and <span class=\"hljs-built_in\">set</span> the deployment user name, please modify it yourself, later take dolphinscheduler as an example</span>\nuseradd dolphinscheduler;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> <span class=\"hljs-built_in\">set</span> the user password, please change it by yourself, later take dolphinscheduler123 as an example</span>\necho &quot;dolphinscheduler123&quot; | passwd --stdin dolphinscheduler\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> configure sudo password-free</span>\necho &#x27;dolphinscheduler  ALL=(ALL)  NOPASSWD: NOPASSWD: ALL&#x27; &gt;&gt; /etc/sudoers\nsed -i &#x27;s/Defaults    requirett/#Defaults    requirett/g&#x27; /etc/sudoers\n\n</code></pre>\n<pre><code class=\"language-markdown\"> Attention:\n<span class=\"hljs-bullet\"> -</span> Since it is sudo -u {linux-user} to switch between different Linux users to run multi-tenant jobs, the deploying user needs to have sudo privileges and be password free.\n<span class=\"hljs-bullet\"> -</span> If you find the line &quot;Default requiretty&quot; in the /etc/sudoers file, please also comment it out.\n<span class=\"hljs-bullet\"> -</span> If resource uploads are used, you also need to assign read and write permissions to the deployment user on <span class=\"hljs-code\">`HDFS or MinIO`</span>.\n</code></pre>\n<h3>Modify Configuration</h3>\n<ul>\n<li>\n<p>From an existing node such as Master/Worker, copy the conf directory directly to replace the conf directory in the new node. After copying, check if the configuration items are correct.</p>\n<pre><code class=\"language-markdown\">Highlights:\ndatasource.properties: database connection information \nzookeeper.properties: information for connecting zk \ncommon.properties: Configuration information about the resource store (if hadoop is set up, please check if the core-site.xml and hdfs-site.xml configuration files exist).\nenv/dolphinscheduler<span class=\"hljs-emphasis\">_env.sh: environment Variables\n</span></code></pre>\n</li>\n<li>\n<p>Modify the <code>dolphinscheduler_env.sh</code> environment variable in the conf/env directory according to the machine configuration (take the example that the software used is installed in /opt/soft)</p>\n<pre><code class=\"language-shell\">    export HADOOP_HOME=/opt/soft/hadoop\n    export HADOOP_CONF_DIR=/opt/soft/hadoop/etc/hadoop\n    # export SPARK_HOME1=/opt/soft/spark1\n    export SPARK_HOME2=/opt/soft/spark2\n    export PYTHON_HOME=/opt/soft/python\n    export JAVA_HOME=/opt/soft/jav\n    export HIVE_HOME=/opt/soft/hive\n    export FLINK_HOME=/opt/soft/flink\n    export DATAX_HOME=/opt/soft/datax/bin/datax.py\n    export PATH=$HADOOP_HOME/bin:$SPARK_HOME2/bin:$PYTHON_HOME:$JAVA_HOME/bin:$HIVE_HOME/bin:$PATH:$FLINK_HOME/bin:$DATAX_HOME:$PATH\n\n</code></pre>\n<p><code>Attention: This step is very important, such as JAVA_HOME and PATH is necessary to configure, not used can be ignored or commented out</code></p>\n</li>\n<li>\n<p>Softlink the JDK to /usr/bin/java (still using JAVA_HOME=/opt/soft/java as an example)</p>\n<pre><code class=\"language-shell\">sudo ln -s /opt/soft/java/bin/java /usr/bin/java\n</code></pre>\n</li>\n<li>\n<p>Modify the configuration file <code>conf/config/install_config.conf</code> on the <strong>all</strong> nodes, synchronizing the following configuration.</p>\n<ul>\n<li>To add a new master node, you need to modify the ips and masters parameters.</li>\n<li>To add a new worker node, modify the ips and workers parameters.</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> <span class=\"hljs-built_in\">which</span> machines to deploy DS services on, separated by commas between multiple physical machines</span>\nips=&quot;ds1,ds2,ds3,ds4&quot;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> ssh port,default 22</span>\nsshPort=&quot;22&quot;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> <span class=\"hljs-built_in\">which</span> machine the master service is deployed on</span>\nmasters=&quot;existing master01,existing master02,ds1,ds2&quot;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> the worker service is deployed on <span class=\"hljs-built_in\">which</span> machine, and specify the worker belongs to <span class=\"hljs-built_in\">which</span> worker group, the following example of <span class=\"hljs-string\">&quot;default&quot;</span> is the group name</span>\nworkers=&quot;existing worker01:default,existing worker02:default,ds3:default,ds4:default&quot;\n\n</code></pre>\n<ul>\n<li>\n<p>If the expansion is for worker nodes, you need to set the worker group. Please refer to the security <a href=\"./security.md\">Worker grouping</a></p>\n</li>\n<li>\n<p>On all new nodes, change the directory permissions so that the deployment user has access to the dolphinscheduler directory</p>\n</li>\n</ul>\n<pre><code class=\"language-shell\">sudo chown -R dolphinscheduler:dolphinscheduler dolphinscheduler\n</code></pre>\n<h3>Restart the Cluster and Verify</h3>\n<ul>\n<li>restart the cluster</li>\n</ul>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> stop <span class=\"hljs-built_in\">command</span>:</span>\n\nbin/stop-all.sh # stop all services\n\nsh bin/dolphinscheduler-daemon.sh stop master-server  # stop master service\nsh bin/dolphinscheduler-daemon.sh stop worker-server  # stop worker service\nsh bin/dolphinscheduler-daemon.sh stop logger-server  # stop logger service\nsh bin/dolphinscheduler-daemon.sh stop api-server     # stop api    service\nsh bin/dolphinscheduler-daemon.sh stop alert-server   # stop alert  service\n<span class=\"hljs-meta\">\n\n#</span><span class=\"bash\"> start <span class=\"hljs-built_in\">command</span>::</span>\nbin/start-all.sh # start all services\n\nsh bin/dolphinscheduler-daemon.sh start master-server  # start master service\nsh bin/dolphinscheduler-daemon.sh start worker-server  # start worker service\nsh bin/dolphinscheduler-daemon.sh start logger-server  # start logger service\nsh bin/dolphinscheduler-daemon.sh start api-server     # start api    service\nsh bin/dolphinscheduler-daemon.sh start alert-server   # start alert  service\n\n</code></pre>\n<pre><code> Attention: When using stop-all.sh or stop-all.sh, if the physical machine executing the command is not configured to be ssh-free on all machines, it will prompt for the password\n</code></pre>\n<ul>\n<li>After the script is completed, use the <code>jps</code> command to see if each node service is started (<code>jps</code> comes with the <code>Java JDK</code>)</li>\n</ul>\n<pre><code>    MasterServer         ----- master service\n    WorkerServer         ----- worker service\n    LoggerServer         ----- logger service\n    ApiApplicationServer ----- api    service\n    AlertServer          ----- alert  service\n</code></pre>\n<p>After successful startup, you can view the logs, which are stored in the logs folder.</p>\n<pre><code class=\"language-Log\"> logs/\n    ├── dolphinscheduler-alert-server.log\n    ├── dolphinscheduler-master-server.log\n    |—— dolphinscheduler-worker-server.log\n    |—— dolphinscheduler-api-server.log\n    |—— dolphinscheduler-logger-server.log\n</code></pre>\n<p>If the above services are started normally and the scheduling system page is normal, check whether there is an expanded Master or Worker service in the [Monitor] of the web system. If it exists, the expansion is complete.</p>\n<hr>\n<h2>Reduction</h2>\n<p>The reduction is to reduce the master or worker services for the existing DolphinScheduler cluster.\nThere are two steps for shrinking. After performing the following two steps, the shrinking operation can be completed.</p>\n<h3>Stop the Service on the Scaled-Down Node</h3>\n<ul>\n<li>If you are scaling down the master node, identify the physical machine where the master service is located, and stop the master service on the physical machine.</li>\n<li>If the worker node is scaled down, determine the physical machine where the worker service is to be scaled down and stop the worker and logger services on the physical machine.</li>\n</ul>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> stop <span class=\"hljs-built_in\">command</span>:</span>\nbin/stop-all.sh # stop all services\n\nsh bin/dolphinscheduler-daemon.sh stop master-server  # stop master service\nsh bin/dolphinscheduler-daemon.sh stop worker-server  # stop worker service\nsh bin/dolphinscheduler-daemon.sh stop logger-server  # stop logger service\nsh bin/dolphinscheduler-daemon.sh stop api-server     # stop api    service\nsh bin/dolphinscheduler-daemon.sh stop alert-server   # stop alert  service\n<span class=\"hljs-meta\">\n\n#</span><span class=\"bash\"> start <span class=\"hljs-built_in\">command</span>:</span>\nbin/start-all.sh # start all services\n\nsh bin/dolphinscheduler-daemon.sh start master-server # start master service\nsh bin/dolphinscheduler-daemon.sh start worker-server # start worker service\nsh bin/dolphinscheduler-daemon.sh start logger-server # start logger service\nsh bin/dolphinscheduler-daemon.sh start api-server    # start api    service\nsh bin/dolphinscheduler-daemon.sh start alert-server  # start alert  service\n\n</code></pre>\n<pre><code> Attention: When using stop-all.sh or stop-all.sh, if the machine without the command is not configured to be ssh-free for all machines, it will prompt for the password.\n</code></pre>\n<ul>\n<li>After the script is completed, use the <code>jps</code> command to see if each node service was successfully shut down (<code>jps</code> comes with the <code>Java JDK</code>)</li>\n</ul>\n<pre><code>    MasterServer         ----- master service\n    WorkerServer         ----- worker service\n    LoggerServer         ----- logger service\n    ApiApplicationServer ----- api    service\n    AlertServer          ----- alert  service\n</code></pre>\n<p>If the corresponding master service or worker service does not exist, then the master/worker service is successfully shut down.</p>\n<h3>Modify the Configuration File</h3>\n<ul>\n<li>\n<p>modify the configuration file <code>conf/config/install_config.conf</code> on the <strong>all</strong> nodes, synchronizing the following configuration.</p>\n<ul>\n<li>to scale down the master node, modify the ips and masters parameters.</li>\n<li>to scale down worker nodes, modify the ips and workers parameters.</li>\n</ul>\n</li>\n</ul>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> <span class=\"hljs-built_in\">which</span> machines to deploy DS services on, <span class=\"hljs-string\">&quot;localhost&quot;</span> <span class=\"hljs-keyword\">for</span> this machine</span>\nips=&quot;ds1,ds2,ds3,ds4&quot;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> ssh port,default: 22</span>\nsshPort=&quot;22&quot;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> <span class=\"hljs-built_in\">which</span> machine the master service is deployed on</span>\nmasters=&quot;existing master01,existing master02,ds1,ds2&quot;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> The worker service is deployed on <span class=\"hljs-built_in\">which</span> machine, and specify <span class=\"hljs-built_in\">which</span> worker group this worker belongs to, the following example of <span class=\"hljs-string\">&quot;default&quot;</span> is the group name</span>\nworkers=&quot;existing worker01:default,existing worker02:default,ds3:default,ds4:default&quot;\n\n</code></pre>\n",
  "link": "/dist/en-us/docs/2.0.3/user_doc/guide/expansion-reduction.html",
  "meta": {}
}