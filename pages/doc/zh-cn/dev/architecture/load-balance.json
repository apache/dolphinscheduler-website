{
  "__html": "<h1 id=\"负载均衡\">负载均衡</h1>\n<p>负载均衡即通过路由算法（通常是集群环境），合理的分摊服务器压力，达到服务器性能的最大优化。</p>\n<h2 id=\"dolphinscheduler-worker-负载均衡算法\">DolphinScheduler-Worker 负载均衡算法</h2>\n<p>DolphinScheduler-Master 分配任务至 worker，提供了四种负载均衡算法：</p>\n<ul>\n<li><strong>随机</strong> (RANDOM)</li>\n<li><strong>轮询</strong> (ROUND_ROBIN)</li>\n<li><strong>平滑轮询</strong> (FIXED_WEIGHTED_ROUND_ROBIN)</li>\n<li><strong>动态平滑轮询</strong> (DYNAMIC_WEIGHTED_ROUND_ROBIN) - 默认算法</li>\n</ul>\n<h2 id=\"负载均衡算法配置\">负载均衡算法配置</h2>\n<p>在配置文件中配置负载均衡算法：</p>\n<p>位置：<code>master-server/conf/application.yaml</code></p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">worker-load-balancer-configuration-properties:</span>\n  <span class=\"hljs-comment\"># 负载均衡算法类型：RANDOM, ROUND_ROBIN, FIXED_WEIGHTED_ROUND_ROBIN, DYNAMIC_WEIGHTED_ROUND_ROBIN</span>\n  <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">DYNAMIC_WEIGHTED_ROUND_ROBIN</span>\n</code></pre>\n<h2 id=\"worker-权重配置\">Worker 权重配置</h2>\n<h3 id=\"平滑轮询权重配置-(fixed_weighted_round_robin)\">平滑轮询权重配置 (FIXED_WEIGHTED_ROUND_ROBIN)</h3>\n<p>对于 <code>FIXED_WEIGHTED_ROUND_ROBIN</code> 算法，可以在每个 worker 的配置文件中修改固定权重：</p>\n<p>位置：<code>worker-server/conf/application.yaml</code></p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">worker:</span>\n  <span class=\"hljs-attr\">host-weight:</span> <span class=\"hljs-number\">100</span> <span class=\"hljs-comment\">#默认值为 100</span>\n</code></pre>\n<h3 id=\"动态平滑轮询权重配置-(dynamic_weighted_round_robin)\">动态平滑轮询权重配置 (DYNAMIC_WEIGHTED_ROUND_ROBIN)</h3>\n<p>当使用 <code>DYNAMIC_WEIGHTED_ROUND_ROBIN</code> 算法时，可以配置各项指标的权重：</p>\n<p>位置：<code>master-server/conf/application.yaml</code></p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">master:</span>\n  <span class=\"hljs-attr\">worker-load-balancer-configuration-properties:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">DYNAMIC_WEIGHTED_ROUND_ROBIN</span>\n    <span class=\"hljs-comment\"># 动态权重配置，仅用于 DYNAMIC_WEIGHTED_ROUND_ROBIN 算法</span>\n    <span class=\"hljs-comment\"># memory-usage、cpu-usage、task-thread-pool-usage 的权重总和必须为 100</span>\n    <span class=\"hljs-attr\">dynamic-weight-config-properties:</span>\n      <span class=\"hljs-attr\">memory-usage-weight:</span> <span class=\"hljs-number\">30</span>    <span class=\"hljs-comment\"># 内存使用率权重</span>\n      <span class=\"hljs-attr\">cpu-usage-weight:</span> <span class=\"hljs-number\">30</span>       <span class=\"hljs-comment\"># CPU 使用率权重  </span>\n      <span class=\"hljs-attr\">task-thread-pool-usage-weight:</span> <span class=\"hljs-number\">40</span>  <span class=\"hljs-comment\"># 任务线程池使用率权重</span>\n</code></pre>\n<h2 id=\"负载均衡算法详解\">负载均衡算法详解</h2>\n<h3 id=\"随机-(random)\">随机 (RANDOM)</h3>\n<p>在可用的 worker 节点中随机选择一台执行任务。</p>\n<h3 id=\"轮询-(round_robin)\">轮询 (ROUND_ROBIN)</h3>\n<p>按照固定的顺序依次选择 worker 节点执行任务，确保每个 worker 都能均匀分配到任务。</p>\n<h3 id=\"平滑轮询-(fixed_weighted_round_robin)\">平滑轮询 (FIXED_WEIGHTED_ROUND_ROBIN)</h3>\n<p>每台 worker 都有两个权重，即 weight（预热完成后保持不变），\ncurrent_weight（动态变化），每次路由。都会遍历所有的 worker，使其 current_weight+weight，同时累加所有 worker 的 weight，计为 total_weight，然后挑选 current_weight 最大的作为本次执行任务的 worker，与此同时，将这台 worker 的 current_weight-total_weight。</p>\n<ul>\n<li>示例：例如有 3 个 worker （A, B, C） 的权重分别为 1、2、3</li>\n<li>worker 选择顺序将为：C B C A B C C B C A B C C B C A B C C B C A B C C B C A B C ... (在上述30轮的调度例子中，每个 worker 分配任务数量：C:15, B:10, A:5, 恰好与权重比例相匹配)</li>\n</ul>\n<h3 id=\"动态平滑轮询-(dynamic_weighted_round_robin)---默认算法\">动态平滑轮询 (DYNAMIC_WEIGHTED_ROUND_ROBIN) - 默认算法</h3>\n<p>该算法每隔一段时间 worker 会向注册中心上报自己的负载信息。我们主要根据CPU使用率、\n内存使用率以及 worker 线程池使用率使用情况来进行判断，具体权重配置如下：</p>\n<ul>\n<li><strong>内存使用率</strong> (默认权重 30%)</li>\n<li><strong>CPU 使用率</strong> (默认权重 30%)</li>\n<li><strong>任务线程池使用率</strong> (默认权重 40%)</li>\n</ul>\n<p>每个 worker 的动态权重通过以下公式计算：</p>\n<pre><code>权重 = 100 - (CPU权重 × CPU使用率 + 内存权重 × 内存使用率 + 线程池权重 × 线程池使用率) ÷ 3\n</code></pre>\n<p>所以当 worker 的负载越低权重就会越高，系统会优先选择负载较低的 worker 节点执行任务。</p>\n<p>在最终选择 worker 节点时，流程与平滑轮询相同，唯一的区别是，该算法下 worker 的权重会动态变化。\n通过这种动态平滑轮询算法，DolphinScheduler 能够智能地将任务分配到负载最低的 worker 上，实现真正的动态负载均衡。</p>\n",
  "location": [
    "架构设计",
    "负载均衡"
  ],
  "structure": [
    {
      "title": "DolphinScheduler-Worker 负载均衡算法",
      "children": [
        {
          "title": "平滑轮询权重配置 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询权重配置-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询权重配置 (DYNAMIC_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "动态平滑轮询权重配置-(dynamic_weighted_round_robin)"
        },
        {
          "title": "随机 (RANDOM)",
          "children": [],
          "anchor": "随机-(random)"
        },
        {
          "title": "轮询 (ROUND_ROBIN)",
          "children": [],
          "anchor": "轮询-(round_robin)"
        },
        {
          "title": "平滑轮询 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询 (DYNAMIC_WEIGHTED_ROUND_ROBIN) - 默认算法",
          "children": [],
          "anchor": "动态平滑轮询-(dynamic_weighted_round_robin)---默认算法"
        }
      ],
      "anchor": "dolphinscheduler-worker-负载均衡算法"
    },
    {
      "title": "负载均衡算法配置",
      "children": [
        {
          "title": "平滑轮询权重配置 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询权重配置-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询权重配置 (DYNAMIC_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "动态平滑轮询权重配置-(dynamic_weighted_round_robin)"
        },
        {
          "title": "随机 (RANDOM)",
          "children": [],
          "anchor": "随机-(random)"
        },
        {
          "title": "轮询 (ROUND_ROBIN)",
          "children": [],
          "anchor": "轮询-(round_robin)"
        },
        {
          "title": "平滑轮询 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询 (DYNAMIC_WEIGHTED_ROUND_ROBIN) - 默认算法",
          "children": [],
          "anchor": "动态平滑轮询-(dynamic_weighted_round_robin)---默认算法"
        }
      ],
      "anchor": "负载均衡算法配置"
    },
    {
      "title": "Worker 权重配置",
      "children": [
        {
          "title": "平滑轮询权重配置 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询权重配置-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询权重配置 (DYNAMIC_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "动态平滑轮询权重配置-(dynamic_weighted_round_robin)"
        },
        {
          "title": "随机 (RANDOM)",
          "children": [],
          "anchor": "随机-(random)"
        },
        {
          "title": "轮询 (ROUND_ROBIN)",
          "children": [],
          "anchor": "轮询-(round_robin)"
        },
        {
          "title": "平滑轮询 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询 (DYNAMIC_WEIGHTED_ROUND_ROBIN) - 默认算法",
          "children": [],
          "anchor": "动态平滑轮询-(dynamic_weighted_round_robin)---默认算法"
        }
      ],
      "anchor": "worker-权重配置"
    },
    {
      "title": "负载均衡算法详解",
      "children": [
        {
          "title": "平滑轮询权重配置 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询权重配置-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询权重配置 (DYNAMIC_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "动态平滑轮询权重配置-(dynamic_weighted_round_robin)"
        },
        {
          "title": "随机 (RANDOM)",
          "children": [],
          "anchor": "随机-(random)"
        },
        {
          "title": "轮询 (ROUND_ROBIN)",
          "children": [],
          "anchor": "轮询-(round_robin)"
        },
        {
          "title": "平滑轮询 (FIXED_WEIGHTED_ROUND_ROBIN)",
          "children": [],
          "anchor": "平滑轮询-(fixed_weighted_round_robin)"
        },
        {
          "title": "动态平滑轮询 (DYNAMIC_WEIGHTED_ROUND_ROBIN) - 默认算法",
          "children": [],
          "anchor": "动态平滑轮询-(dynamic_weighted_round_robin)---默认算法"
        }
      ],
      "anchor": "负载均衡算法详解"
    }
  ],
  "title": "负载均衡",
  "link": "/architecture/load-balance"
}