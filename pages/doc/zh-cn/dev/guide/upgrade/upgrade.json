{
  "__html": "<h1 id=\"dolphinscheduler-升级\">DolphinScheduler 升级</h1>\n<h2 id=\"准备工作\">准备工作</h2>\n<h3 id=\"检查不向前兼容的更改\">检查不向前兼容的更改</h3>\n<p>在升级之前，您应该检查 <a href=\"/zh-cn/docs/dev/guide/upgrade/incompatible\">incompatible change</a>，因为一些不兼容的更改可能会破坏您当前的功能。</p>\n<h3 id=\"备份上一版本文件和数据库\">备份上一版本文件和数据库</h3>\n<p>为了防止操作错误导致数据丢失，建议升级之前备份数据，备份方法请结合你数据库的情况来定</p>\n<h3 id=\"下载新版本的安装包\">下载新版本的安装包</h3>\n<p>在<a href=\"https://dolphinscheduler.apache.org/zh-cn/download\">下载</a>页面下载最新版本的二进制安装包，并将二进制包放到与当前 dolphinscheduler 服务不一样的路径中，以下升级操作都需要在新版本的目录进行。</p>\n<h2 id=\"升级步骤\">升级步骤</h2>\n<h3 id=\"停止-dolphinscheduler-所有服务\">停止 dolphinscheduler 所有服务</h3>\n<p>根据你部署方式停止 dolphinscheduler 的所有服务。</p>\n<h3 id=\"数据库升级\">数据库升级</h3>\n<p>设置相关环境变量（{user}和{password}改成你数据库的用户名和密码），然后运行升级脚本。</p>\n<p>下面以 MySQL 为例，别的数据库仅需要修改成对应的配置即可。请先手动下载 <a href=\"https://downloads.MySQL.com/archives/c-j/\">mysql-connector-java 驱动 jar</a>\njar 包 并添加到 <code>./tools/libs</code> 目录下，设置以下环境变量</p>\n<pre><code>    ```shell\n    export DATABASE=${DATABASE:-mysql}\n    export SPRING_PROFILES_ACTIVE=${DATABASE}\n    export SPRING_DATASOURCE_URL=&quot;jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&quot;\n    export SPRING_DATASOURCE_USERNAME={user}\n    export SPRING_DATASOURCE_PASSWORD={password}\n    ```\n</code></pre>\n<p>执行数据库升级脚本：<code>sh ./tools/bin/upgrade-schema.sh</code></p>\n<h3 id=\"资源迁移\">资源迁移</h3>\n<p>3.2.0 版本资源中心重构，原资源中心内的资源将不受管理，您可以指定迁移到的目标租户，然后运行一次性资源迁移脚本，所有资源会迁移到目标租户的 .migrate 目录下。</p>\n<h4 id=\"示例：\">示例：</h4>\n<p>指定已存在目标租户 <code>abc</code>，其资源根目录为 <code>/dolphinscheduler/abc/</code>。</p>\n<p>执行脚本：<code>sh ./tools/bin/migrate-resource.sh abc</code>。</p>\n<p>执行结果：</p>\n<ul>\n<li>原文件资源 <code>a/b.sh</code> 迁移至 <code>/dolphinscheduler/abc/resources/.migrate/a/b.sh</code>。</li>\n<li>原 UDF 资源 <code>x/y.jar</code> 迁移至 <code>/dolphinscheduler/abc/udf/.migrate/x/y.jar</code>。</li>\n<li>更新 UDF 函数绑定资源信息。</li>\n</ul>\n<h3 id=\"血缘升级\">血缘升级</h3>\n<p>执行脚本：<code>sh ./tools/bin/migrate-lineage.sh</code>。</p>\n<p>执行结果：</p>\n<ul>\n<li>原血缘数据迁移至新血缘表 <code>t_ds_workflow_task_lineage</code>。</li>\n<li>此脚本仅执行 upsert 操作，不执行删除操作，如果需要删除，您可以手动删除。</li>\n</ul>\n<h3 id=\"服务升级\">服务升级</h3>\n<h4 id=\"修改配置内容\">修改配置内容</h4>\n<ul>\n<li>伪集群部署请参照<a href=\"/zh-cn/docs/dev/guide/installation/pseudo-cluster\">伪集群部署(Pseudo-Cluster)</a>中的 <code>修改相关配置</code></li>\n<li>集群部署请参照<a href=\"/zh-cn/docs/dev/guide/installation/cluster\">集群部署(Cluster)</a>中的 <code>修改相关配置</code></li>\n</ul>\n<h2 id=\"注意事项\">注意事项</h2>\n<h4 id=\"升级版本限制\">升级版本限制</h4>\n<ul>\n<li>在 3.3.X 以及之后的版本，我们仅支持从 3.0.0 开始进行升级，低于此版本的请下载历史版本升级至 3.0.0。</li>\n<li>在 3.3.X 以及之后的版本，二进制包不再默认提供插件依赖，因此第一次使用时，需要自行下载安装。具体请参考请参照<a href=\"/zh-cn/docs/dev/guide/installation/pseudo-cluster\">伪集群部署(Pseudo-Cluster)</a></li>\n</ul>\n<h4 id=\"升级后的注意事项\">升级后的注意事项</h4>\n<p>在历史版本中可能告警插件会有一些脏数据，升级后请参考一下 SQL 手动清理。</p>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">delete</span> <span class=\"hljs-keyword\">from</span> t_ds_alertgroup <span class=\"hljs-keyword\">where</span> group_name <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&#x27;global alert group&#x27;</span> <span class=\"hljs-keyword\">and</span> description <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&#x27;global alert group&#x27;</span>;\n</code></pre>\n",
  "location": [
    "功能介绍",
    "升级",
    "升级步骤"
  ],
  "structure": [
    {
      "title": "准备工作",
      "children": [
        {
          "title": "检查不向前兼容的更改",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "检查不向前兼容的更改"
        },
        {
          "title": "备份上一版本文件和数据库",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "备份上一版本文件和数据库"
        },
        {
          "title": "下载新版本的安装包",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "下载新版本的安装包"
        },
        {
          "title": "停止 dolphinscheduler 所有服务",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "停止-dolphinscheduler-所有服务"
        },
        {
          "title": "数据库升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "数据库升级"
        },
        {
          "title": "资源迁移",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "资源迁移"
        },
        {
          "title": "血缘升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "血缘升级"
        },
        {
          "title": "服务升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "服务升级"
        }
      ],
      "anchor": "准备工作"
    },
    {
      "title": "升级步骤",
      "children": [
        {
          "title": "检查不向前兼容的更改",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "检查不向前兼容的更改"
        },
        {
          "title": "备份上一版本文件和数据库",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "备份上一版本文件和数据库"
        },
        {
          "title": "下载新版本的安装包",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "下载新版本的安装包"
        },
        {
          "title": "停止 dolphinscheduler 所有服务",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "停止-dolphinscheduler-所有服务"
        },
        {
          "title": "数据库升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "数据库升级"
        },
        {
          "title": "资源迁移",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "资源迁移"
        },
        {
          "title": "血缘升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "血缘升级"
        },
        {
          "title": "服务升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "服务升级"
        }
      ],
      "anchor": "升级步骤"
    },
    {
      "title": "注意事项",
      "children": [
        {
          "title": "检查不向前兼容的更改",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "检查不向前兼容的更改"
        },
        {
          "title": "备份上一版本文件和数据库",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "备份上一版本文件和数据库"
        },
        {
          "title": "下载新版本的安装包",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "下载新版本的安装包"
        },
        {
          "title": "停止 dolphinscheduler 所有服务",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "停止-dolphinscheduler-所有服务"
        },
        {
          "title": "数据库升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "数据库升级"
        },
        {
          "title": "资源迁移",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "资源迁移"
        },
        {
          "title": "血缘升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "血缘升级"
        },
        {
          "title": "服务升级",
          "children": [
            {
              "title": "示例：",
              "children": [],
              "anchor": "示例："
            },
            {
              "title": "修改配置内容",
              "children": [],
              "anchor": "修改配置内容"
            },
            {
              "title": "升级版本限制",
              "children": [],
              "anchor": "升级版本限制"
            },
            {
              "title": "升级后的注意事项",
              "children": [],
              "anchor": "升级后的注意事项"
            }
          ],
          "anchor": "服务升级"
        }
      ],
      "anchor": "注意事项"
    }
  ],
  "title": "DolphinScheduler 升级",
  "link": "/guide/upgrade/upgrade"
}