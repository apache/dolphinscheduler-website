{
  "__html": "<h1 id=\"mlflow节点\">MLflow节点</h1>\n<h2 id=\"综述\">综述</h2>\n<p><a href=\"https://mlflow.org\">MLflow</a> 是一个MLops领域一个优秀的开源项目， 用于管理机器学习的生命周期，包括实验、可再现性、部署和中心模型注册。</p>\n<p>MLflow 组件用于执行 MLflow 任务，目前包含Mlflow Projects，和MLflow Models。（Model Registry将在不就的将来支持）。</p>\n<ul>\n<li>MLflow Projects: 将代码打包，并可以运行到任务的平台上。</li>\n<li>MLflow Models: 在不同的服务环境中部署机器学习模型。</li>\n<li>Model Registry: 在一个中央存储库中存储、注释、发现和管理模型 (你也可以在你的MLflow project 里面自行注册模型)。</li>\n</ul>\n<p>目前 Mlflow 组件支持的和即将支持的内容如下中：</p>\n<ul>\n<li>MLflow Projects\n<ul>\n<li>BasicAlgorithm: 基础算法，包含LogisticRegression， svm， lightgbm， xgboost</li>\n<li>AutoML: AutoML工具，包含autosklean， flaml</li>\n<li>Custom projects: 支持运行自己的MLflow Projects项目</li>\n</ul>\n</li>\n<li>MLflow Models\n<ul>\n<li>MLFLOW: 直接使用 <code>mlflow models serve</code> 部署模型。</li>\n<li>Docker: 打包 DOCKER 镜像后部署模型。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"创建任务\">创建任务</h2>\n<ul>\n<li>点击项目管理-项目名称-工作流定义，点击“创建工作流”按钮，进入 DAG 编辑页面；</li>\n<li>拖动工具栏的 <img src=\"/img/tasks/icons/mlflow.png\" width=\"15\"/> 任务节点到画板中。</li>\n</ul>\n<h2 id=\"任务样例\">任务样例</h2>\n<ul>\n<li>默认参数说明请参考<a href=\"/zh-cn/docs/3.1.5/guide/task/appendix\">DolphinScheduler任务参数附录</a><code>默认任务参数</code>一栏。</li>\n</ul>\n<p>以下是一些MLflow 组件的常用参数</p>\n<table>\n<thead>\n<tr>\n<th><strong>任务参数</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MLflow Tracking Server URI</td>\n<td>MLflow Tracking Server 的连接，默认 http://localhost:5000</td>\n</tr>\n<tr>\n<td>实验名称</td>\n<td>任务运行时所在的实验，若实验不存在，则创建。若实验名称为空，则设置为<code>Default</code>，与 MLflow 一样</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"mlflow-projects\">MLflow Projects</h3>\n<h4 id=\"basicalgorithm\">BasicAlgorithm</h4>\n<p><img src=\"/img/tasks/demo/mlflow-basic-algorithm.png\" alt=\"mlflow-conda-env\"></p>\n<table>\n<thead>\n<tr>\n<th><strong>任务参数</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>注册模型</td>\n<td>是否注册模型，若选择注册，则会展开以下参数</td>\n</tr>\n<tr>\n<td>注册的模型名称</td>\n<td>注册的模型名称，会在原来的基础上加上一个模型版本，并注册为Production</td>\n</tr>\n<tr>\n<td>数据路径</td>\n<td>文件/文件夹的绝对路径，若文件需以.csv结尾（自动切分训练集与测试集），文件夹需包含train.csv和test.csv（建议方式，用户应自行构建测试集用于模型评估）。详细的参数列表如下: <a href=\"https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html#sklearn.linear_model.LogisticRegression\">LogisticRegression</a>  <a href=\"https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html?highlight=svc#sklearn.svm.SVC\">SVM</a>  <a href=\"https://lightgbm.readthedocs.io/en/latest/pythonapi/lightgbm.LGBMClassifier.html#lightgbm.LGBMClassifier\">lightgbm</a>   <a href=\"https://xgboost.readthedocs.io/en/stable/python/python_api.html#xgboost.XGBClassifier\">xgboost</a></td>\n</tr>\n<tr>\n<td>算法</td>\n<td>选择的算法，目前基于 <a href=\"https://scikit-learn.org/\">scikit-learn</a> 形式支持 <code>lr</code>，<code>svm</code>，<code>lightgbm</code>，<code>xgboost</code></td>\n</tr>\n<tr>\n<td>参数搜索空间</td>\n<td>运行对应算法的参数搜索空间，可为空。如针对lightgbm 的 <code>max_depth=[5, 10];n_estimators=[100, 200]</code> 则会进行对应搜索。约定传入后会以;切分各个参数，等号前的名字作为参数名，等号后的名字将以python eval执行得到对应的参数值</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"automl\">AutoML</h4>\n<p><img src=\"/img/tasks/demo/mlflow-automl.png\" alt=\"mlflow-automl\"></p>\n<table>\n<thead>\n<tr>\n<th><strong>任务参数</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>注册模型</td>\n<td>是否注册模型，若选择注册，则会展开以下参数</td>\n</tr>\n<tr>\n<td>注册的模型名称</td>\n<td>注册的模型名称，会在原来的基础上加上一个模型版本，并注册为Production</td>\n</tr>\n<tr>\n<td>数据路径</td>\n<td>文件/文件夹的绝对路径，若文件需以.csv结尾（自动切分训练集与测试集），文件夹需包含train.csv和test.csv（建议方式，用户应自行构建测试集用于模型评估）</td>\n</tr>\n<tr>\n<td>参数</td>\n<td>初始化AutoML训练器时的参数，可为空，如针对 flaml 设置<code>time_budget=30;estimator_list=['lgbm']</code>。约定传入后会以; 切分各个参数，等号前的名字作为参数名，等号后的名字将以python eval执行得到对应的参数值。详细的参数列表如下: <a href=\"https://microsoft.github.io/FLAML/docs/Use-Cases/Task-Oriented-AutoML\">flaml</a>，<a href=\"https://automl.github.io/auto-sklearn/master/api.html\">autosklearn</a></td>\n</tr>\n<tr>\n<td>AutoML工具</td>\n<td>使用的AutoML工具，目前支持 <a href=\"https://github.com/automl/auto-sklearn\">autosklearn</a>，<a href=\"https://github.com/microsoft/FLAML\">flaml</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"custom-projects\">Custom projects</h4>\n<p><img src=\"/img/tasks/demo/mlflow-custom-project.png\" alt=\"mlflow-custom-project.png\"></p>\n<table>\n<thead>\n<tr>\n<th><strong>任务参数</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>参数</td>\n<td><code>mlflow run</code>中的 --param-list 如 <code>-P learning_rate=0.2 -P colsample_bytree=0.8 -P subsample=0.9</code></td>\n</tr>\n<tr>\n<td>运行仓库</td>\n<td>MLflow Project的仓库地址，可以为github地址，或者worker上的目录，如MLflow project位于子目录，可以添加 <code>#</code> 隔开，如 <code>https://github.com/mlflow/mlflow#examples/xgboost/xgboost_native</code></td>\n</tr>\n<tr>\n<td>项目版本</td>\n<td>对应项目中git版本管理中的版本，默认 master</td>\n</tr>\n</tbody>\n</table>\n<p>现在你可以使用这个功能来运行github上所有的MLflow Projects (如 <a href=\"https://github.com/mlflow/mlflow/tree/master/examples\">MLflow examples</a> )了。你也可以创建自己的机器学习库，用来复用你的研究成果，以后你就可以使用DolphinScheduler来一键操作使用你的算法库。</p>\n<h3 id=\"mlflow-models\">MLflow Models</h3>\n<table>\n<thead>\n<tr>\n<th><strong>任务参数</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>部署模型的URI</td>\n<td>MLflow 服务里面模型对应的URI，支持 <code>models:/&lt;model_name&gt;/suffix</code> 格式 和 <code>runs:/</code> 格式</td>\n</tr>\n<tr>\n<td>监听端口</td>\n<td>部署服务时的端口</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"mlflow\">MLFLOW</h4>\n<p><img src=\"/img/tasks/demo/mlflow-models-mlflow.png\" alt=\"mlflow-models-mlflow\"></p>\n<h4 id=\"docker\">Docker</h4>\n<p><img src=\"/img/tasks/demo/mlflow-models-docker.png\" alt=\"mlflow-models-docker\"></p>\n<h2 id=\"环境准备\">环境准备</h2>\n<h3 id=\"conda-环境配置\">conda 环境配置</h3>\n<p>请提前<a href=\"https://docs.continuum.io/anaconda/install/\">安装anaconda</a> 或者<a href=\"https://docs.conda.io/en/latest/miniconda.html#installing\">安装miniconda</a></p>\n<p><strong>方法A：</strong></p>\n<p>配置文件：/dolphinscheduler/conf/env/dolphinscheduler_env.sh。</p>\n<p>在文件最后添加内容</p>\n<pre><code># 配置你的conda环境路径\nexport PATH=/opt/anaconda3/bin:$PATH\n</code></pre>\n<p><strong>方法B：</strong></p>\n<p>你需要进入admin账户配置一个conda环境变量。</p>\n<p><img src=\"/img/tasks/demo/mlflow-conda-env.png\" alt=\"mlflow-conda-env\"></p>\n<p>后续注意配置任务时，环境选择上面创建的conda环境，否则程序会找不到conda环境。</p>\n<p><img src=\"/img/tasks/demo/mlflow-set-conda-env.png\" alt=\"mlflow-set-conda-env\"></p>\n<h3 id=\"mlflow-service-启动\">MLflow service 启动</h3>\n<p>确保你已经安装MLflow，可以使用<code>pip install mlflow</code>进行安装。</p>\n<p>在你想保存实验和模型的地方建立一个文件夹，然后启动 mlflow service。</p>\n<pre><code class=\"language-sh\"><span class=\"hljs-built_in\">mkdir</span> mlflow\n<span class=\"hljs-built_in\">cd</span> mlflow\nmlflow server -h 0.0.0.0 -p 5000 --serve-artifacts --backend-store-uri sqlite:///mlflow.db\n</code></pre>\n<p>运行后会启动一个MLflow服务。</p>\n<p>可以通过访问 MLflow service (<code>http://localhost:5000</code>) 页面查看实验与模型。</p>\n<p><img src=\"/img/tasks/demo/mlflow-server.png\" alt=\"mlflow-server\"></p>\n<h3 id=\"内置算法仓库配置\">内置算法仓库配置</h3>\n<p>如果遇到github无法访问的情况，可以修改<code>commom.properties</code>配置文件的以下字段，将github地址替换能访问的地址。</p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-comment\"># mlflow task plugin preset repository</span>\n<span class=\"hljs-string\">ml.mlflow.preset_repository=https://github.com/apache/dolphinscheduler-mlflow</span>\n<span class=\"hljs-comment\"># mlflow task plugin preset repository version</span>\n<span class=\"hljs-string\">ml.mlflow.preset_repository_version=&quot;main&quot;</span>\n</code></pre>\n",
  "location": [
    "功能介绍",
    "任务类型",
    "MLflow"
  ],
  "time": "2023-04-06",
  "structure": [
    {
      "title": "综述",
      "children": [
        {
          "title": "MLflow Projects",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-projects"
        },
        {
          "title": "MLflow Models",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-models"
        },
        {
          "title": "conda 环境配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "conda-环境配置"
        },
        {
          "title": "MLflow service 启动",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-service-启动"
        },
        {
          "title": "内置算法仓库配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "内置算法仓库配置"
        }
      ],
      "anchor": "综述"
    },
    {
      "title": "创建任务",
      "children": [
        {
          "title": "MLflow Projects",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-projects"
        },
        {
          "title": "MLflow Models",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-models"
        },
        {
          "title": "conda 环境配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "conda-环境配置"
        },
        {
          "title": "MLflow service 启动",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-service-启动"
        },
        {
          "title": "内置算法仓库配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "内置算法仓库配置"
        }
      ],
      "anchor": "创建任务"
    },
    {
      "title": "任务样例",
      "children": [
        {
          "title": "MLflow Projects",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-projects"
        },
        {
          "title": "MLflow Models",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-models"
        },
        {
          "title": "conda 环境配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "conda-环境配置"
        },
        {
          "title": "MLflow service 启动",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-service-启动"
        },
        {
          "title": "内置算法仓库配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "内置算法仓库配置"
        }
      ],
      "anchor": "任务样例"
    },
    {
      "title": "环境准备",
      "children": [
        {
          "title": "MLflow Projects",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-projects"
        },
        {
          "title": "MLflow Models",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-models"
        },
        {
          "title": "conda 环境配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "conda-环境配置"
        },
        {
          "title": "MLflow service 启动",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "mlflow-service-启动"
        },
        {
          "title": "内置算法仓库配置",
          "children": [
            {
              "title": "BasicAlgorithm",
              "children": [],
              "anchor": "basicalgorithm"
            },
            {
              "title": "AutoML",
              "children": [],
              "anchor": "automl"
            },
            {
              "title": "Custom projects",
              "children": [],
              "anchor": "custom-projects"
            },
            {
              "title": "MLFLOW",
              "children": [],
              "anchor": "mlflow"
            },
            {
              "title": "Docker",
              "children": [],
              "anchor": "docker"
            }
          ],
          "anchor": "内置算法仓库配置"
        }
      ],
      "anchor": "环境准备"
    }
  ],
  "title": "MLflow节点",
  "link": "/guide/task/mlflow"
}