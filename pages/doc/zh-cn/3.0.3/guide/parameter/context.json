{
  "__html": "<h1 id=\"参数的引用\">参数的引用</h1>\n<p>DolphinScheduler 提供参数间相互引用的能力，包括：本地参数引用全局参数、上下游参数传递。因为有引用的存在，就涉及当参数名相同时，参数的优先级问题，详见<a href=\"/zh-cn/docs/3.0.3/guide/parameter/priority\">参数优先级</a></p>\n<h2 id=\"本地任务引用全局参数\">本地任务引用全局参数</h2>\n<p>本地任务引用全局参数的前提是，你已经定义了<a href=\"/zh-cn/docs/3.0.3/guide/parameter/global\">全局参数</a>，使用方式和<a href=\"/zh-cn/docs/3.0.3/guide/parameter/local\">本地参数</a>中的使用方式类似，但是参数的值需要配置成全局参数中的 key。</p>\n<h2 id=\"上游任务传递给下游任务\">上游任务传递给下游任务</h2>\n<p>DolphinScheduler 允许在任务间进行参数传递，目前传递方向仅支持上游单向传递给下游。目前支持这个特性的任务类型有：</p>\n<ul>\n<li><a href=\"/zh-cn/docs/3.0.3/guide/task/shell\">Shell</a></li>\n<li><a href=\"/zh-cn/docs/3.0.3/guide/task/sql\">SQL</a></li>\n<li><a href=\"/zh-cn/docs/3.0.3/guide/task/stored-procedure\">Procedure</a></li>\n</ul>\n<p>当定义上游节点时，如果有需要将该节点的结果传递给有依赖关系的下游节点，需要在【当前节点设置】的【自定义参数】设置一个方向是 OUT 的变量。目前我们主要针对 SQL 和 SHELL 节点做了可以向下传递参数的功能。</p>\n<blockquote>\n<p>注：若节点之间没有依赖关系，则局部参数无法通过上游传递。</p>\n</blockquote>\n<h3 id=\"任务样例\">任务样例</h3>\n<p>本样例展示了如何使用参数传递的功能，通过 SHELL 任务来创建本地参数并赋值传递给下游，SQL 任务通过获得上游任务的参数完成查询操作。</p>\n<h4 id=\"创建-shell-任务，设置参数\">创建 SHELL 任务，设置参数</h4>\n<blockquote>\n<p>用户需要传递参数，在定义 SHELL 脚本时，需要输出格式为 ${setValue(key=value)} 的语句，key 为对应参数的 prop，value 为该参数的值。</p>\n</blockquote>\n<p>创建 Node_A 任务，在自定义参数中添加 output 和 value 参数，并编写如下脚本：</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter01.png\" alt=\"context-parameter01\"></p>\n<p>参数说明：</p>\n<ul>\n<li>value：方向选择为 IN，并赋值为 66</li>\n<li>output：方向选择为 OUT，通过脚本 <code>'${setValue(output=1)}'</code> 赋值，并传递给下游参数</li>\n</ul>\n<p>SHELL 节点定义时当日志检测到 ${setValue(output=1)} 的格式时，会将 1 赋值给 output，下游节点便可以直接使用变量 output 的值。同样，您可以在【工作流实例】页面，找到对应的节点实例，便可以查看该变量的值。</p>\n<p>创建 Node_B 任务，主要用于测试输出上游任务 Node_A 传递的参数。</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter02.png\" alt=\"context-parameter02\"></p>\n<h4 id=\"创建-sql-任务，使用参数\">创建 SQL 任务，使用参数</h4>\n<p>完成上述的 SHELL 任务之后，我们可以使用上游所传递的 output 作为 SQL 的查询对象。其中将所查询的 id 重命名为 ID，作为参数输出。</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter03.png\" alt=\"context-parameter03\"></p>\n<blockquote>\n<p>注：如果 SQL 节点的结果只有一行，一个或多个字段，参数的名字需要和字段名称一致。数据类型可选择为除 LIST 以外的其他类型。变量会选择 SQL 查询结果中的列名中与该变量名称相同的列对应的值。</p>\n<p>如果 SQL 节点的结果为多行，一个或多个字段，参数的名字需要和字段名称一致。数据类型选择为 LIST。获取到 SQL 查询结果后会将对应列转化为 LIST，并将该结果转化为 JSON 后作为对应变量的值。</p>\n</blockquote>\n<h4 id=\"保存工作流，设置全局参数\">保存工作流，设置全局参数</h4>\n<p>点击保存工作流图标，并设置全局参数 output 和 value。</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter04.png\" alt=\"context-parameter03\"></p>\n<h4 id=\"查看运行结果\">查看运行结果</h4>\n<p>创建完成工作流之后，上线运行该工作流，查看其运行结果。</p>\n<p>Node_A 运行结果如下：</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_log01.png\" alt=\"context-log01\"></p>\n<p>Node_B 运行结果如下：</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_log02.png\" alt=\"context-log02\"></p>\n<p>Node_mysql 运行结果如下：</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_log03.png\" alt=\"context-log03\"></p>\n<p>虽然在 Node_A 的脚本中为 output 赋值为 1，但日志中显示的值仍然为 100。但根据<a href=\"/zh-cn/docs/3.0.3/guide/parameter/priority\">参数优先级</a>的原则：<code>本地参数 &gt; 上游任务传递的参数 &gt; 全局参数</code>，在 Node_B 中输出的值为 1。则证明 output 参数参照预期的值在该工作流中传递，并在 Node_mysql 中使用该值完成查询操作。</p>\n<p>但是 value 的值却只有在 Node_A 中输出为 66，其原因为 value 的方向选择为 IN，只有当方向为 OUT 时才会被定义为变量输出。</p>\n",
  "location": [
    "功能介绍",
    "参数",
    "参数传递"
  ],
  "time": "2022-12-08",
  "structure": [
    {
      "title": "本地任务引用全局参数",
      "children": [
        {
          "title": "任务样例",
          "children": [
            {
              "title": "创建 SHELL 任务，设置参数",
              "children": [],
              "anchor": "创建-shell-任务，设置参数"
            },
            {
              "title": "创建 SQL 任务，使用参数",
              "children": [],
              "anchor": "创建-sql-任务，使用参数"
            },
            {
              "title": "保存工作流，设置全局参数",
              "children": [],
              "anchor": "保存工作流，设置全局参数"
            },
            {
              "title": "查看运行结果",
              "children": [],
              "anchor": "查看运行结果"
            }
          ],
          "anchor": "任务样例"
        }
      ],
      "anchor": "本地任务引用全局参数"
    },
    {
      "title": "上游任务传递给下游任务",
      "children": [
        {
          "title": "任务样例",
          "children": [
            {
              "title": "创建 SHELL 任务，设置参数",
              "children": [],
              "anchor": "创建-shell-任务，设置参数"
            },
            {
              "title": "创建 SQL 任务，使用参数",
              "children": [],
              "anchor": "创建-sql-任务，使用参数"
            },
            {
              "title": "保存工作流，设置全局参数",
              "children": [],
              "anchor": "保存工作流，设置全局参数"
            },
            {
              "title": "查看运行结果",
              "children": [],
              "anchor": "查看运行结果"
            }
          ],
          "anchor": "任务样例"
        }
      ],
      "anchor": "上游任务传递给下游任务"
    }
  ],
  "title": "参数的引用",
  "link": "/guide/parameter/context"
}