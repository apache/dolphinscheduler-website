{
  "__html": "<h1 id=\"parameter-context\">Parameter Context</h1>\n<p>DolphinScheduler provides the ability to refer to each other between parameters, including local parameters refer to global parameters and upstream and downstream parameter transfer. Due to the existence of references, it involves the priority of parameters when the parameter names are the same. see also <a href=\"/en-us/docs/dev/guide/parameter/priority\">Parameter Priority</a></p>\n<h2 id=\"local-task-refers-to-global-parameter\">Local Task Refers to Global Parameter</h2>\n<p>The premise of local tasks referring global parameters is that you have already defined <a href=\"/en-us/docs/dev/guide/parameter/global\">Global Parameter</a>. The usage is similar to the usage in <a href=\"/en-us/docs/dev/guide/parameter/local\">local parameters</a>, but the value of the parameter needs to be configured as the key of the global parameter.</p>\n<h2 id=\"pass-parameter-from-upstream-task-to-downstream\">Pass Parameter From Upstream Task to Downstream</h2>\n<p>DolphinScheduler allows parameter transfer between tasks. Currently, transfer direction only supports one-way transfer from upstream to downstream. The task types that support this feature areï¼š</p>\n<ul>\n<li><a href=\"/en-us/docs/dev/guide/task/shell\">Shell</a></li>\n<li><a href=\"/en-us/docs/dev/guide/task/sql\">SQL</a></li>\n<li><a href=\"/en-us/docs/dev/guide/task/stored-procedure\">Procedure</a></li>\n<li><a href=\"/en-us/docs/dev/guide/task/python\">Python</a></li>\n<li><a href=\"../task/sub-workflow.md\">SubWorkflow</a></li>\n<li><a href=\"../task//en-us/docs/dev/guide/installation/kubernetes\">Kubernetes</a></li>\n<li><a href=\"../task/zeppelin.md\">zeppelin</a></li>\n</ul>\n<p>When defining an upstream node, if there is a need to transmit the result of that node to a dependency related downstream node. You need to set an <code>OUT</code> direction parameter to [Custom Parameters] of the [Current Node Settings]. If it is a sub-workflow node, there is no need to set a parameter in [Current Node Settings], but an <code>OUT</code> direction parameter needs to be set in the workflow definition of the sub-workflow.</p>\n<p>The value of upstream parameter can be updated in downstream node in the same way as <a href=\"#create-a-shell-task-and-set-parameters\">setting parameter</a>.</p>\n<p>Upstream parameter will be override when defining parameter with the same name in downstream node.</p>\n<blockquote>\n<p>Note:</p>\n<ol>\n<li>\n<p>Parameter passing behavior has changed in version 3.3.x**\nIn older version before 3.2.2, downstream node B could obtain the out type output X of upstream node A without configuring an IN type local variable X.\nIn the new version after 3.3.0, the logic for obtaining local variables has been modified: downstream node B can only use the out type output X of upstream node A if it has configured an IN type local variable X.\nSee the Node_B and Node_mysql examples below for details.</p>\n</li>\n<li>\n<p>If there are no dependencies between nodes, local parameters cannot be passed upstream.</p>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"example\">Example</h3>\n<p>This sample shows how to use the parameter passing function. Create local parameters and assign them to downstream through the SHELL task. The SQL task completes the query operation by obtaining the parameters of the upstream task.</p>\n<h4 id=\"create-a-shell-task-and-set-parameters\">Create a SHELL task and set parameters</h4>\n<p>The user needs to pass the parameter when creating the shell script, the output statement format is <code>'${setValue(key=value)}'</code>, the key is the <code>prop</code> of the corresponding parameter, and value is the value of the parameter.</p>\n<p>Create a Node_A task, add output and value parameters to the custom parameters, and write the following script:</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter01.png\" alt=\"context-parameter01\"></p>\n<p>Parameter Description:</p>\n<ul>\n<li>value: The direction selection is IN, and the value is 66</li>\n<li>output: The direction is selected as OUT, assigned through the script<code>'${setValue(output=1)}'</code>, and passed to the downstream parameters</li>\n</ul>\n<p>When the SHELL node is defined, the log detects the format of <code>${setValue(output=1)}</code>, it will assign 1 to output, and the downstream node can directly use the value of the variable output. Similarly, you can find the corresponding node instance on the [Workflow Instance] page, and then you can view the value of this variable.</p>\n<p>Create the Node_B task, which is mainly used to test and output the parameters passed by the upstream task Node_A.</p>\n<p>In the custom parameters, add an IN type value parameter and an output parameter.</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter02.png\" alt=\"context-parameter02\"></p>\n<h4 id=\"create-sql-tasks-and-use-parameters\">Create SQL tasks and use parameters</h4>\n<p>When the SHELL task is completed, we can use the output passed upstream as the query object for the SQL. The id of the query is renamed to ID and is output as a parameter.</p>\n<p>In the custom parameters, add an <code>OUT</code> type <code>ID</code> parameter and an <code>IN</code> type <code>output</code> parameter.</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter03.png\" alt=\"context-parameter03\"></p>\n<blockquote>\n<p>Note: If the result of the SQL node has only one row, one or multiple fields, the name of the <code>prop</code> needs to be the same as the field name. The data type can choose structure except <code>LIST</code>. The parameter assigns the value according to the same column name in the SQL query result.</p>\n<p>If the result of the SQL node has multiple rows, one or more fields, the name of the <code>prop</code> needs to be the same as the field name. Choose the data type structure as <code>LIST</code>, and the SQL query result will be converted to <code>LIST&lt;VARCHAR&gt;</code>, and forward to convert to JSON as the parameter value.</p>\n</blockquote>\n<h4 id=\"save-the-workflow-and-set-the-global-parameters\">Save the workflow and set the global parameters</h4>\n<p>Click on the Save workflow icon and set the global parameters output and value.</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_parameter04.png\" alt=\"context-parameter04\"></p>\n<h4 id=\"view-results\">View results</h4>\n<p>After the workflow is created, run the workflow online and view its running results.</p>\n<p>The result of Node_A is as follows:</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_log01.png\" alt=\"context-log01\"></p>\n<p>The result of Node_B is as follows:</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_log02.png\" alt=\"context-log02\"></p>\n<p>The result of Node_mysql is as follows:</p>\n<p><img src=\"/img/new_ui/dev/parameter/context_log03.png\" alt=\"context-log03\"></p>\n<p>Even though output is assigned a value of 1 in Node_A's script, the log still shows a value of 100. But according to the principle from <a href=\"/en-us/docs/dev/guide/parameter/priority\">parameter priority</a>: <code>Startup Parameter &gt; Local Parameter &gt; Parameter Context &gt; Global Parameter</code>, the output value in Node_B is 1. It proves that the output parameter is passed in the workflow with reference to the expected value, and the query operation is completed using this value in Node_mysql.</p>\n<p>But the output value 66 only shows in the Node_A, the reason is that the direction of value is selected as IN, and only when the direction is OUT will it be defined as a variable output.</p>\n<h4 id=\"pass-parameter-from-python-task-to-downstream\">Pass parameter from Python task to downstream</h4>\n<p>Use <code>print('${setValue(key=%s)}' % value)</code>, DolphinScheduler will capture the <code>${setValue(key=value}</code> in the output to capture the parameters and pass them downstream.</p>\n<p>For example</p>\n<p><img src=\"/img/new_ui/dev/parameter/python_context_param.png\" alt=\"python_context_param\"></p>\n<p>Attention: When the variable value contains the <code>\\n</code> identifier, such as <code>value = &quot;hello \\n world&quot;</code>, value needs to be carried out in a special way. You need to use <code>print('${setValue(key=%s)}' % repr(value))</code>, otherwise the argument cannot be passed to the subsequent flow.</p>\n<h4 id=\"pass-parameter-from-subworkflow-task-to-downstream\">Pass parameter from SubWorkflow task to downstream</h4>\n<p>In the workflow definition of the sub-workflow, define <code>OUT</code> direction parameters as output parameters, and these parameters can be passed to the downstream tasks of the sub-workflow node.</p>\n<p>Create an A task in the workflow definition of the sub-workflow, add var1 and var2 parameters to the custom parameters, and write the following script:</p>\n<p><img src=\"/img/new_ui/dev/parameter/context-sub-workflow01.png\" alt=\"context-sub-workflow01\"></p>\n<p>Save the sub-workflow_example1 workflow and set the global parameters var1.</p>\n<p><img src=\"/img/new_ui/dev/parameter/context-sub-workflow02.png\" alt=\"context-sub-workflow02\"></p>\n<p>Create a sub_workflow task in a new workflow, and use the sub-workflow_example1 workflow as the sub-node.</p>\n<p><img src=\"/img/new_ui/dev/parameter/context-sub-workflow03.png\" alt=\"context-sub-workflow03\"></p>\n<p>Create a shell task as a downstream task of the sub_workflow task, and write the following script:</p>\n<p><img src=\"/img/new_ui/dev/parameter/context-sub-workflow04.png\" alt=\"context-sub-workflow04\"></p>\n<p>Save the workflow and run it. The result of the downstream task is as follows:</p>\n<p><img src=\"/img/new_ui/dev/parameter/context-sub-workflow05.png\" alt=\"context-sub-workflow05\"></p>\n<p>Although the two parameters var1 and var2 are output in the A task, only the <code>OUT</code> parameter var1 is defined in the workflow definition, and the downstream task successfully outputs var1. It proves that the var1 parameter is passed in the workflow with reference to the expected value.</p>\n<h4 id=\"pass-parameter-from-kubernetes-task-to-downstream\">Pass parameter from Kubernetes task to downstream</h4>\n<p>Different programming languages may use different logging frameworks in Kubernetes tasks. To be compatible with these frameworks, DolphinScheduler provides a universal logging data format <code>${(key=value)}</code> or <code>#{(key=value)}</code>. Users can output log data in the format in the terminal logs of their applications, where <code>key</code> is the corresponding parameter prop and <code>value</code> is the value of that parameter. DolphinScheduler will capture the <code>${(key=value)}</code> or <code>#{(key=value)}</code> in the output logs to capture the parameters and pass them downstream.</p>\n<p>For example</p>\n<p><img src=\"/img/new_ui/dev/parameter/k8s_context_param.png\" alt=\"kubernetes_context_param\"></p>\n<p>Another special consideration, not always can DolphinScheduler collect pod logs, if the user redirects the log output stream, DolphinScheduler can not collect logs for use and can not use the output parameter, either.</p>\n<h4 id=\"pass-parameter-from-zeppelin-task-to-downstream\">Pass parameter from Zeppelin task to downstream</h4>\n<p>In the custom parameters, add an <code>IN</code> type <code>input</code> parameter.</p>\n<p>For example</p>\n<p><img src=\"/img/new_ui/dev/parameter/zeppelin_parameters01.png\" alt=\"zeppelin_parameters\"></p>\n<p>Note: json key must be enclosed in &quot; &quot;</p>\n",
  "location": [
    "Introduction to Functions",
    "Parameter",
    "Parameter Context"
  ],
  "structure": [
    {
      "title": "Local Task Refers to Global Parameter",
      "children": [
        {
          "title": "Example",
          "children": [
            {
              "title": "Create a SHELL task and set parameters",
              "children": [],
              "anchor": "create-a-shell-task-and-set-parameters"
            },
            {
              "title": "Create SQL tasks and use parameters",
              "children": [],
              "anchor": "create-sql-tasks-and-use-parameters"
            },
            {
              "title": "Save the workflow and set the global parameters",
              "children": [],
              "anchor": "save-the-workflow-and-set-the-global-parameters"
            },
            {
              "title": "View results",
              "children": [],
              "anchor": "view-results"
            },
            {
              "title": "Pass parameter from Python task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-python-task-to-downstream"
            },
            {
              "title": "Pass parameter from SubWorkflow task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-subworkflow-task-to-downstream"
            },
            {
              "title": "Pass parameter from Kubernetes task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-kubernetes-task-to-downstream"
            },
            {
              "title": "Pass parameter from Zeppelin task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-zeppelin-task-to-downstream"
            }
          ],
          "anchor": "example"
        }
      ],
      "anchor": "local-task-refers-to-global-parameter"
    },
    {
      "title": "Pass Parameter From Upstream Task to Downstream",
      "children": [
        {
          "title": "Example",
          "children": [
            {
              "title": "Create a SHELL task and set parameters",
              "children": [],
              "anchor": "create-a-shell-task-and-set-parameters"
            },
            {
              "title": "Create SQL tasks and use parameters",
              "children": [],
              "anchor": "create-sql-tasks-and-use-parameters"
            },
            {
              "title": "Save the workflow and set the global parameters",
              "children": [],
              "anchor": "save-the-workflow-and-set-the-global-parameters"
            },
            {
              "title": "View results",
              "children": [],
              "anchor": "view-results"
            },
            {
              "title": "Pass parameter from Python task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-python-task-to-downstream"
            },
            {
              "title": "Pass parameter from SubWorkflow task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-subworkflow-task-to-downstream"
            },
            {
              "title": "Pass parameter from Kubernetes task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-kubernetes-task-to-downstream"
            },
            {
              "title": "Pass parameter from Zeppelin task to downstream",
              "children": [],
              "anchor": "pass-parameter-from-zeppelin-task-to-downstream"
            }
          ],
          "anchor": "example"
        }
      ],
      "anchor": "pass-parameter-from-upstream-task-to-downstream"
    }
  ],
  "title": "Parameter Context",
  "link": "/guide/parameter/context"
}