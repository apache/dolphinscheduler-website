{
  "__html": "<h2>dolphinscheduler json拆解</h2>\n<h2>1、为什么拆解json</h2>\n<p>在dolphinscheduler 1.3.x及以前的工作流中的任务及任务关系保存时是以大json的方式保存到数据库中process_definiton表的process_definition_json字段，如果某个工作流很大比如有100或者1000个任务，这个json字段也就非常大，在使用时需要解析json，非常耗费性能，且任务没法重用；基于大json，在工作流版本及任务版本上也没有好的实现方案，否则会导致数据大量冗余。</p>\n<p>故社区计划启动json拆解项目，实现的需求目标：</p>\n<ul>\n<li>大json完全拆分</li>\n<li>新增工作流及任务版本</li>\n<li>引入全局唯一键(code)</li>\n</ul>\n<h2>2、如何设计拆解后的表</h2>\n<h3>1、1.3.6版本工作流</h3>\n<p>1、比如在当前1.3.6版本创建个a--&gt;b的工作流</p>\n<p><img src=\"/img/dolphinscheduler_json_20210601/image-20210524102618970.png\" alt=\"image-20210524102618970\"></p>\n<p>以下是processDefiniton save 接口在controller入口打印的入参日志</p>\n<pre><code>create  process definition, project name: hadoop, process definition name: ab, process_definition_json: {&quot;globalParams&quot;:[],&quot;tasks&quot;:[{&quot;type&quot;:&quot;SHELL&quot;,&quot;id&quot;:&quot;tasks-77643&quot;,&quot;name&quot;:&quot;a&quot;,&quot;params&quot;:{&quot;resourceList&quot;:[],&quot;localParams&quot;:[{&quot;prop&quot;:&quot;yesterday&quot;,&quot;direct&quot;:&quot;IN&quot;,&quot;type&quot;:&quot;VARCHAR&quot;,&quot;value&quot;:&quot;${system.biz.date}&quot;}],&quot;rawScript&quot;:&quot;echo ${yesterday}&quot;},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;&quot;],&quot;failedNode&quot;:[&quot;&quot;]},&quot;dependence&quot;:{},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[]},{&quot;type&quot;:&quot;SHELL&quot;,&quot;id&quot;:&quot;tasks-99814&quot;,&quot;name&quot;:&quot;b&quot;,&quot;params&quot;:{&quot;resourceList&quot;:[],&quot;localParams&quot;:[{&quot;prop&quot;:&quot;today&quot;,&quot;direct&quot;:&quot;IN&quot;,&quot;type&quot;:&quot;VARCHAR&quot;,&quot;value&quot;:&quot;${system.biz.curdate}&quot;}],&quot;rawScript&quot;:&quot;echo ${today}&quot;},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;&quot;],&quot;failedNode&quot;:[&quot;&quot;]},&quot;dependence&quot;:{},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[&quot;a&quot;]}],&quot;tenantId&quot;:1,&quot;timeout&quot;:0}, desc:  locations:{&quot;tasks-77643&quot;:{&quot;name&quot;:&quot;a&quot;,&quot;targetarr&quot;:&quot;&quot;,&quot;nodenumber&quot;:&quot;1&quot;,&quot;x&quot;:251,&quot;y&quot;:166},&quot;tasks-99814&quot;:{&quot;name&quot;:&quot;b&quot;,&quot;targetarr&quot;:&quot;tasks-77643&quot;,&quot;nodenumber&quot;:&quot;0&quot;,&quot;x&quot;:533,&quot;y&quot;:161}}, connects:[{&quot;endPointSourceId&quot;:&quot;tasks-77643&quot;,&quot;endPointTargetId&quot;:&quot;tasks-99814&quot;}]\n</code></pre>\n<p>2、依赖节点的工作流，dep是依赖节点</p>\n<p><img src=\"/img/dolphinscheduler_json_20210601/image-20210524104503423.png\" alt=\"image-20210524104503423\"></p>\n<p>以下是processDefiniton save 接口在controller入口打印的入参日志</p>\n<pre><code> create  process definition, project name: hadoop, process definition name: dep_c, process_definition_json: {&quot;globalParams&quot;:[],&quot;tasks&quot;:[{&quot;type&quot;:&quot;SHELL&quot;,&quot;id&quot;:&quot;tasks-69503&quot;,&quot;name&quot;:&quot;c&quot;,&quot;params&quot;:{&quot;resourceList&quot;:[],&quot;localParams&quot;:[],&quot;rawScript&quot;:&quot;echo 11&quot;},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;&quot;],&quot;failedNode&quot;:[&quot;&quot;]},&quot;dependence&quot;:{},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[&quot;dep&quot;]},{&quot;type&quot;:&quot;DEPENDENT&quot;,&quot;id&quot;:&quot;tasks-22756&quot;,&quot;name&quot;:&quot;dep&quot;,&quot;params&quot;:{},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;&quot;],&quot;failedNode&quot;:[&quot;&quot;]},&quot;dependence&quot;:{&quot;relation&quot;:&quot;AND&quot;,&quot;dependTaskList&quot;:[{&quot;relation&quot;:&quot;AND&quot;,&quot;dependItemList&quot;:[{&quot;projectId&quot;:1,&quot;definitionId&quot;:1,&quot;depTasks&quot;:&quot;b&quot;,&quot;cycle&quot;:&quot;day&quot;,&quot;dateValue&quot;:&quot;today&quot;}]}]},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[]}],&quot;tenantId&quot;:1,&quot;timeout&quot;:0}, desc:  locations:{&quot;tasks-69503&quot;:{&quot;name&quot;:&quot;c&quot;,&quot;targetarr&quot;:&quot;tasks-22756&quot;,&quot;nodenumber&quot;:&quot;0&quot;,&quot;x&quot;:597,&quot;y&quot;:166},&quot;tasks-22756&quot;:{&quot;name&quot;:&quot;dep&quot;,&quot;targetarr&quot;:&quot;&quot;,&quot;nodenumber&quot;:&quot;1&quot;,&quot;x&quot;:308,&quot;y&quot;:164}}, connects:[{&quot;endPointSourceId&quot;:&quot;tasks-22756&quot;,&quot;endPointTargetId&quot;:&quot;tasks-69503&quot;}]\n</code></pre>\n<p>3、条件判断的工作流</p>\n<p><img src=\"/img/dolphinscheduler_json_20210601/image-20210524104218236.png\" alt=\"image-20210524104218236\"></p>\n<p>以下是processDefiniton save 接口在controller入口打印的入参日志</p>\n<pre><code>create  process definition, project name: hadoop, process definition name: condition_test, process_definition_json: {&quot;globalParams&quot;:[],&quot;tasks&quot;:[{&quot;type&quot;:&quot;SHELL&quot;,&quot;id&quot;:&quot;tasks-68456&quot;,&quot;name&quot;:&quot;d&quot;,&quot;params&quot;:{&quot;resourceList&quot;:[],&quot;localParams&quot;:[],&quot;rawScript&quot;:&quot;echo 11&quot;},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;&quot;],&quot;failedNode&quot;:[&quot;&quot;]},&quot;dependence&quot;:{},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[]},{&quot;type&quot;:&quot;SHELL&quot;,&quot;id&quot;:&quot;tasks-58183&quot;,&quot;name&quot;:&quot;e&quot;,&quot;params&quot;:{&quot;resourceList&quot;:[],&quot;localParams&quot;:[],&quot;rawScript&quot;:&quot;echo 22&quot;},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;&quot;],&quot;failedNode&quot;:[&quot;&quot;]},&quot;dependence&quot;:{},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[&quot;cond&quot;]},{&quot;type&quot;:&quot;SHELL&quot;,&quot;id&quot;:&quot;tasks-43996&quot;,&quot;name&quot;:&quot;f&quot;,&quot;params&quot;:{&quot;resourceList&quot;:[],&quot;localParams&quot;:[],&quot;rawScript&quot;:&quot;echo 33&quot;},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;&quot;],&quot;failedNode&quot;:[&quot;&quot;]},&quot;dependence&quot;:{},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[&quot;cond&quot;]},{&quot;type&quot;:&quot;CONDITIONS&quot;,&quot;id&quot;:&quot;tasks-38972&quot;,&quot;name&quot;:&quot;cond&quot;,&quot;params&quot;:{},&quot;description&quot;:&quot;&quot;,&quot;timeout&quot;:{&quot;strategy&quot;:&quot;&quot;,&quot;interval&quot;:null,&quot;enable&quot;:false},&quot;runFlag&quot;:&quot;NORMAL&quot;,&quot;conditionResult&quot;:{&quot;successNode&quot;:[&quot;e&quot;],&quot;failedNode&quot;:[&quot;f&quot;]},&quot;dependence&quot;:{&quot;relation&quot;:&quot;AND&quot;,&quot;dependTaskList&quot;:[{&quot;relation&quot;:&quot;AND&quot;,&quot;dependItemList&quot;:[{&quot;depTasks&quot;:&quot;d&quot;,&quot;status&quot;:&quot;SUCCESS&quot;}]}]},&quot;maxRetryTimes&quot;:&quot;0&quot;,&quot;retryInterval&quot;:&quot;1&quot;,&quot;taskInstancePriority&quot;:&quot;MEDIUM&quot;,&quot;workerGroup&quot;:&quot;default&quot;,&quot;preTasks&quot;:[&quot;d&quot;]}],&quot;tenantId&quot;:1,&quot;timeout&quot;:0}, desc:  locations:{&quot;tasks-68456&quot;:{&quot;name&quot;:&quot;d&quot;,&quot;targetarr&quot;:&quot;&quot;,&quot;nodenumber&quot;:&quot;1&quot;,&quot;x&quot;:168,&quot;y&quot;:158},&quot;tasks-58183&quot;:{&quot;name&quot;:&quot;e&quot;,&quot;targetarr&quot;:&quot;tasks-38972&quot;,&quot;nodenumber&quot;:&quot;0&quot;,&quot;x&quot;:573,&quot;y&quot;:82},&quot;tasks-43996&quot;:{&quot;name&quot;:&quot;f&quot;,&quot;targetarr&quot;:&quot;tasks-38972&quot;,&quot;nodenumber&quot;:&quot;0&quot;,&quot;x&quot;:591,&quot;y&quot;:288},&quot;tasks-38972&quot;:{&quot;name&quot;:&quot;cond&quot;,&quot;targetarr&quot;:&quot;tasks-68456&quot;,&quot;nodenumber&quot;:&quot;2&quot;,&quot;x&quot;:382,&quot;y&quot;:175}}, connects:[{&quot;endPointSourceId&quot;:&quot;tasks-68456&quot;,&quot;endPointTargetId&quot;:&quot;tasks-38972&quot;},{&quot;endPointSourceId&quot;:&quot;tasks-38972&quot;,&quot;endPointTargetId&quot;:&quot;tasks-58183&quot;},{&quot;endPointSourceId&quot;:&quot;tasks-38972&quot;,&quot;endPointTargetId&quot;:&quot;tasks-43996&quot;}]\n</code></pre>\n<p>从以上三个案例中，我们知道controller的入口参数的每个参数都可以在t_ds_process_definition表中找到对应，故表中数据如下图</p>\n<p><img src=\"/img/dolphinscheduler_json_20210601/image-20210524104838911.png\" alt=\"image-20210524104838911\"></p>\n<h3>2、拆解后的表设计思路</h3>\n<p>工作流只是dag的展现形式，任务通过工作流进行组织，组织的同时存在了任务之间的关系，也就是依赖。就好比一个画板，画板上有些图案，工作流就是画板，图案就是任务，图案之间的关系就是依赖。而调度的核心是调度任务，依赖只是表述调度的先后顺序。当前定时还是对整个工作流进行的定时，拆解后就方便对单独任务进行调度。正是基于这个思想设计了拆解的思路，所以这就需要三张表，工作流定义表、任务定义表、任务关系表。</p>\n<ul>\n<li>工作流定义表：描述工作流的基本信息，比如全局参数、dag中节点的位置信息</li>\n<li>任务定义表：描述任务的详情信息，比如任务类别、任务容错信息、优先级等</li>\n<li>任务关系表：描述任务的关系信息，比如当前节点、前置节点等</li>\n</ul>\n<p>基于这个设计思想再扩展到版本，无非是对于这三张表，每张表新增个保存版本的日志表。</p>\n<h4>工作流定义表</h4>\n<p>现在看案例中save接口日志，现有字段(project、process_definition_name、desc、locations、connects)，对于json中除了task之外的还剩下</p>\n<pre><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span><span class=\"hljs-attr\">&quot;globalParams&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-attr\">&quot;tenantId&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span><span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span><span class=\"hljs-number\">0</span><span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>所以可知工作流定义表：</p>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> `t_ds_process_definition` (\n  `id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&#x27;self-increasing id&#x27;</span>,\n  `code` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;encoding&#x27;</span>,\n  `name` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">200</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition name&#x27;</span>,\n  `version` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition version&#x27;</span>,\n  `description` text COMMENT <span class=\"hljs-string\">&#x27;description&#x27;</span>,\n  `project_code` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;project code&#x27;</span>,\n  `release_state` tinyint(<span class=\"hljs-number\">4</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition release state：0:offline,1:online&#x27;</span>,\n  `user_id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition creator id&#x27;</span>,\n  `global_params` text COMMENT <span class=\"hljs-string\">&#x27;global parameters&#x27;</span>,\n  `flag` tinyint(<span class=\"hljs-number\">4</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;0 not available, 1 available&#x27;</span>,\n  `locations` text COMMENT <span class=\"hljs-string\">&#x27;Node location information&#x27;</span>,\n  `connects` text COMMENT <span class=\"hljs-string\">&#x27;Node connection information&#x27;</span>,\n  `warning_group_id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;alert group id&#x27;</span>,\n  `timeout` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&#x27;0&#x27;</span> COMMENT <span class=\"hljs-string\">&#x27;time out, unit: minute&#x27;</span>,\n  `tenant_id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&#x27;-1&#x27;</span> COMMENT <span class=\"hljs-string\">&#x27;tenant id&#x27;</span>,\n  `create_time` datetime <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;create time&#x27;</span>,\n  `update_time` datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;update time&#x27;</span>,\n  <span class=\"hljs-keyword\">PRIMARY</span> KEY (`id`,`code`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `process_unique` (`name`,`project_code`) <span class=\"hljs-keyword\">USING</span> BTREE\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> `t_ds_process_definition_log` (\n  `id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&#x27;self-increasing id&#x27;</span>,\n  `code` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;encoding&#x27;</span>,\n  `name` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">200</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition name&#x27;</span>,\n  `version` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition version&#x27;</span>,\n  `description` text COMMENT <span class=\"hljs-string\">&#x27;description&#x27;</span>,\n  `project_code` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;project code&#x27;</span>,\n  `release_state` tinyint(<span class=\"hljs-number\">4</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition release state：0:offline,1:online&#x27;</span>,\n  `user_id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;process definition creator id&#x27;</span>,\n  `global_params` text COMMENT <span class=\"hljs-string\">&#x27;global parameters&#x27;</span>,\n  `flag` tinyint(<span class=\"hljs-number\">4</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;0 not available, 1 available&#x27;</span>,\n  `locations` text COMMENT <span class=\"hljs-string\">&#x27;Node location information&#x27;</span>,\n  `connects` text COMMENT <span class=\"hljs-string\">&#x27;Node connection information&#x27;</span>,\n  `warning_group_id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;alert group id&#x27;</span>,\n  `timeout` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&#x27;0&#x27;</span> COMMENT <span class=\"hljs-string\">&#x27;time out,unit: minute&#x27;</span>,\n  `tenant_id` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&#x27;-1&#x27;</span> COMMENT <span class=\"hljs-string\">&#x27;tenant id&#x27;</span>,\n  `operator` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;operator user id&#x27;</span>,\n  `operate_time` datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;operate time&#x27;</span>,\n  `create_time` datetime <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;create time&#x27;</span>,\n  `update_time` datetime <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&#x27;update time&#x27;</span>,\n  <span class=\"hljs-keyword\">PRIMARY</span> KEY (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n</code></pre>\n<p>从表字段可以看出 日志表仅仅比主表多了两个字段operator、operate_time</p>\n<h4>任务定义表</h4>\n<p>案例中ab工作流task的json</p>\n<pre><code class=\"language-json\">\t<span class=\"hljs-attr\">&quot;tasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-77643&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;a&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;prop&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;yesterday&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;direct&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;IN&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;VARCHAR&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;${system.biz.date}&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo ${yesterday}&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-99814&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;b&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;prop&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;today&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;direct&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;IN&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;VARCHAR&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;${system.biz.curdate}&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo ${today}&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;a&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n</code></pre>\n<p>dep_c工作流task的json</p>\n<pre><code class=\"language-json\">\t<span class=\"hljs-attr\">&quot;tasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-69503&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;c&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo 11&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;dep&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;DEPENDENT&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-22756&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;dep&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;relation&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;AND&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;dependTaskList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;relation&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;AND&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;dependItemList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;projectId&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;definitionId&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;depTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;b&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;cycle&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;day&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;dateValue&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;today&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n</code></pre>\n<p>condition_test工作流task的json</p>\n<pre><code class=\"language-json\">\t<span class=\"hljs-attr\">&quot;tasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-68456&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;d&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo 11&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-58183&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;e&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo 22&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;cond&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-43996&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;f&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo 33&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;cond&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;CONDITIONS&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-38972&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;cond&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;description&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;e&quot;</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;f&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;relation&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;AND&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;dependTaskList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;relation&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;AND&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;dependItemList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;depTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;d&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;status&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SUCCESS&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;default&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">&quot;d&quot;</span><span class=\"hljs-punctuation\">]</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n</code></pre>\n<p>从案例中可以知道SHELL/DEPENDENT/CONDITIONS类型的节点的json构成（其他任务类似SHELL），preTasks标识前置依赖节点。conditionResult结构比较固定，而dependence结构复杂，DEPENDENT和CONDITIONS类型任务的dependence结构还不一样，所以为了统一，我们将conditionResult和dependence整体放到params中，params对应表字段的task_params。</p>\n<p>这样我们就确定了t_ds_task_definition表</p>\n<pre><code class=\"language-mysql\">CREATE TABLE `t_ds_task_definition` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'self-increasing id',\n  `code` bigint(20) NOT NULL COMMENT 'encoding',\n  `name` varchar(200) DEFAULT NULL COMMENT 'task definition name',\n  `version` int(11) DEFAULT NULL COMMENT 'task definition version',\n  `description` text COMMENT 'description',\n  `project_code` bigint(20) NOT NULL COMMENT 'project code',\n  `user_id` int(11) DEFAULT NULL COMMENT 'task definition creator id',\n  `task_type` varchar(50) NOT NULL COMMENT 'task type',\n  `task_params` text COMMENT 'job custom parameters',\n  `flag` tinyint(2) DEFAULT NULL COMMENT '0 not available, 1 available',\n  `task_priority` tinyint(4) DEFAULT NULL COMMENT 'job priority',\n  `worker_group` varchar(200) DEFAULT NULL COMMENT 'worker grouping',\n  `fail_retry_times` int(11) DEFAULT NULL COMMENT 'number of failed retries',\n  `fail_retry_interval` int(11) DEFAULT NULL COMMENT 'failed retry interval',\n  `timeout_flag` tinyint(2) DEFAULT '0' COMMENT 'timeout flag:0 close, 1 open',\n  `timeout_notify_strategy` tinyint(4) DEFAULT NULL COMMENT 'timeout notification policy: 0 warning, 1 fail',\n  `timeout` int(11) DEFAULT '0' COMMENT 'timeout length,unit: minute',\n  `delay_time` int(11) DEFAULT '0' COMMENT 'delay execution time,unit: minute',\n  `resource_ids` varchar(255) DEFAULT NULL COMMENT 'resource id, separated by comma',\n  `create_time` datetime NOT NULL COMMENT 'create time',\n  `update_time` datetime DEFAULT NULL COMMENT 'update time',\n  PRIMARY KEY (`id`,`code`),\n  UNIQUE KEY `task_unique` (`name`,`project_code`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nCREATE TABLE `t_ds_task_definition_log` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'self-increasing id',\n  `code` bigint(20) NOT NULL COMMENT 'encoding',\n  `name` varchar(200) DEFAULT NULL COMMENT 'task definition name',\n  `version` int(11) DEFAULT NULL COMMENT 'task definition version',\n  `description` text COMMENT 'description',\n  `project_code` bigint(20) NOT NULL COMMENT 'project code',\n  `user_id` int(11) DEFAULT NULL COMMENT 'task definition creator id',\n  `task_type` varchar(50) NOT NULL COMMENT 'task type',\n  `task_params` text COMMENT 'job custom parameters',\n  `flag` tinyint(2) DEFAULT NULL COMMENT '0 not available, 1 available',\n  `task_priority` tinyint(4) DEFAULT NULL COMMENT 'job priority',\n  `worker_group` varchar(200) DEFAULT NULL COMMENT 'worker grouping',\n  `fail_retry_times` int(11) DEFAULT NULL COMMENT 'number of failed retries',\n  `fail_retry_interval` int(11) DEFAULT NULL COMMENT 'failed retry interval',\n  `timeout_flag` tinyint(2) DEFAULT '0' COMMENT 'timeout flag:0 close, 1 open',\n  `timeout_notify_strategy` tinyint(4) DEFAULT NULL COMMENT 'timeout notification policy: 0 warning, 1 fail',\n  `timeout` int(11) DEFAULT '0' COMMENT 'timeout length,unit: minute',\n  `delay_time` int(11) DEFAULT '0' COMMENT 'delay execution time,unit: minute',\n  `resource_ids` varchar(255) DEFAULT NULL COMMENT 'resource id, separated by comma',\n  `operator` int(11) DEFAULT NULL COMMENT 'operator user id',\n  `operate_time` datetime DEFAULT NULL COMMENT 'operate time',\n  `create_time` datetime NOT NULL COMMENT 'create time',\n  `update_time` datetime DEFAULT NULL COMMENT 'update time',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n</code></pre>\n<p><strong>注意：dev版本和1.3.6版本区别，dev版本已将description换成desc，并且新增了delayTime</strong></p>\n<pre><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n\t<span class=\"hljs-attr\">&quot;globalParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t<span class=\"hljs-attr\">&quot;tasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-18200&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;d&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;code&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo 5&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;desc&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;delayTime&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;waitStartTimeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;hadoop&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;depList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-55225&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;e&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;code&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo 6&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;desc&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;delayTime&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;waitStartTimeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;hadoop&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t<span class=\"hljs-string\">&quot;def&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;depList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SHELL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-67639&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;f&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;code&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;resourceList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;localParams&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;rawScript&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;echo 7&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;desc&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;delayTime&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;waitStartTimeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;hadoop&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t<span class=\"hljs-string\">&quot;def&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;depList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;CONDITIONS&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;id&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;tasks-67387&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;def&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;code&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;params&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;desc&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;runFlag&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;NORMAL&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;conditionResult&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;successNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;e&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;failedNode&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t\t<span class=\"hljs-string\">&quot;f&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;dependence&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;relation&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;AND&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;dependTaskList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;relation&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;AND&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;dependItemList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t\t\t<span class=\"hljs-attr\">&quot;depTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;d&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t\t\t<span class=\"hljs-attr\">&quot;status&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;SUCCESS&quot;</span>\n\t\t\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t\t<span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t\t\t<span class=\"hljs-attr\">&quot;depTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;d&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t\t\t<span class=\"hljs-attr\">&quot;status&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;FAILURE&quot;</span>\n\t\t\t\t\t\t<span class=\"hljs-punctuation\">}</span>\n\t\t\t\t\t<span class=\"hljs-punctuation\">]</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;maxRetryTimes&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;retryInterval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;1&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;delayTime&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;0&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;strategy&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;interval&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;enable&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;waitStartTimeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span><span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;taskInstancePriority&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;MEDIUM&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;workerGroup&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;hadoop&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;preTasks&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n\t\t\t\t<span class=\"hljs-string\">&quot;d&quot;</span>\n\t\t\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;depList&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">null</span></span>\n\t\t<span class=\"hljs-punctuation\">}</span>\n\t<span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t<span class=\"hljs-attr\">&quot;tenantId&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span><span class=\"hljs-punctuation\">,</span>\n\t<span class=\"hljs-attr\">&quot;timeout&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">0</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<h4>任务关系表</h4>\n<p>preTasks标识前置依赖节点，当前节点在关系表中使用postTask标识。由于当前节点肯定存在而前置节点不一定存在，所以post不可能为空，而preTask有可能为空</p>\n<pre><code class=\"language-mysql\">CREATE TABLE `t_ds_process_task_relation` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'self-increasing id',\n  `name` varchar(200) DEFAULT NULL COMMENT 'relation name',\n  `process_definition_version` int(11) DEFAULT NULL COMMENT 'process version',\n  `project_code` bigint(20) NOT NULL COMMENT 'project code',\n  `process_definition_code` bigint(20) NOT NULL COMMENT 'process code',\n  `pre_task_code` bigint(20) NOT NULL COMMENT 'pre task code',\n  `pre_task_version` int(11) NOT NULL COMMENT 'pre task version',\n  `post_task_code` bigint(20) NOT NULL COMMENT 'post task code',\n  `post_task_version` int(11) NOT NULL COMMENT 'post task version',\n  `condition_type` tinyint(2) DEFAULT NULL COMMENT 'condition type : 0 none, 1 judge 2 delay',\n  `condition_params` text COMMENT 'condition params(json)',\n  `create_time` datetime NOT NULL COMMENT 'create time',\n  `update_time` datetime DEFAULT NULL COMMENT 'update time',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nCREATE TABLE `t_ds_process_task_relation_log` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'self-increasing id',\n  `name` varchar(200) DEFAULT NULL COMMENT 'relation name',\n  `process_definition_version` int(11) DEFAULT NULL COMMENT 'process version',\n  `project_code` bigint(20) NOT NULL COMMENT 'project code',\n  `process_definition_code` bigint(20) NOT NULL COMMENT 'process code',\n  `pre_task_code` bigint(20) NOT NULL COMMENT 'pre task code',\n  `pre_task_version` int(11) NOT NULL COMMENT 'pre task version',\n  `post_task_code` bigint(20) NOT NULL COMMENT 'post task code',\n  `post_task_version` int(11) NOT NULL COMMENT 'post task version',\n  `condition_type` tinyint(2) DEFAULT NULL COMMENT 'condition type : 0 none, 1 judge 2 delay',\n  `condition_params` text COMMENT 'condition params(json)',\n  `operator` int(11) DEFAULT NULL COMMENT 'operator user id',\n  `operate_time` datetime DEFAULT NULL COMMENT 'operate time',\n  `create_time` datetime NOT NULL COMMENT 'create time',\n  `update_time` datetime DEFAULT NULL COMMENT 'update time',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n</code></pre>\n<p>对于依赖关系复杂的场景</p>\n<p><img src=\"/img/dolphinscheduler_json_20210601/image-20210524144950185.png\" alt=\"image-20210524144950185\"></p>\n<h2>3、API模块如何改造</h2>\n<p><img src=\"/img/dolphinscheduler_json_20210601/1620304011852-1621754591271.png\" alt=\"拆分方案-1620304011852\"></p>\n<ul>\n<li>[ ] api模块进行save操作时</li>\n</ul>\n<ol>\n<li>通过雪花算法生成13位的数字作为process_definition_code，工作流定义保存至process_definition（主表）和process_definition_log（日志表），这两个表保存的是同样的数据，工作流定义版本为1</li>\n<li>通过雪花算法生成13位的数字作为task_definition_code，任务定义表保存至task_definition（主表）和task_definition_log（日志表），也是保存同样的数据，任务定义版本为1</li>\n<li>工作流任务关系保存在 process_task_relation（主表）和process_task_relation_log（日志表），该表保存的code和version是工作流的code和version，因为任务是通过工作流进行组织，以工作流来画dag。也是通过post_task_code和post_task_version标识dag的当前节点，这个节点的前置依赖通过pre_task_code和pre_task_version来标识，如果没有依赖，pre_task_code和pre_task_version为0</li>\n</ol>\n<ul>\n<li>\n<p>[ ] api模块进行update操作时，工作流定义和任务定义直接更新主表数据，更新后的数据insert到日志表。关系表主表先删除然后再插入新的关系，关系表日志表直接插入新的关系</p>\n</li>\n<li>\n<p>[ ] api模块进行delete操作时，工作流定义、任务定义和关系表直接删除主表数据，日志表数据不变动</p>\n</li>\n<li>\n<p>[ ] api模块进行switch操作时，直接将日志表中对应version数据覆盖到主表</p>\n</li>\n</ul>\n<h2>4、数据交互如何改造</h2>\n<p><img src=\"/img/dolphinscheduler_json_20210601/json.png\" alt=\"json\"></p>\n<ul>\n<li>\n<p>[ ] 在json拆分一期api模块controller层整体未变动，传入的大json还是在service层映射为ProcessData对象。insert或update操作在公共Service模块通过ProcessService.saveProcessDefiniton()入口完成保存数据库操作，按照task_definition、process_task_relation、process_definition的顺序保存。保存时，如果该任务已经存在并且关联的工作流未上线，则更改任务；如果任务关联的工作流已上线，则不允许更改任务</p>\n</li>\n<li>\n<p>[ ] api查询操作时，当前还是通过工作流id来查询，在公共Service模块通过ProcessService.genTaskNodeList()入口完成数据组装，还是组装为ProcessData对象，进而生成json返回</p>\n</li>\n<li>\n<p>[ ] Server模块（Master）也是通过公共Service模块ProcessService.genTaskNodeList()获得TaskNodeList生成调度dag，把当前任务所有信息放到 MasterExecThread.readyToSubmitTaskQueue队列，以便生成taskInstance，dispatch给worker</p>\n</li>\n</ul>\n<h2>5、当前json还需做什么</h2>\n<ul>\n<li>controller对外restAPI接口改造</li>\n<li>ui模块dag改造</li>\n<li>ui模块新增task操作页面</li>\n</ul>\n<p><strong>processDefinition</strong></p>\n<table>\n<thead>\n<tr>\n<th>接口名称</th>\n<th>参数名称</th>\n<th style=\"text-align:center\">参数说明</th>\n<th>数据类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td>projectName</td>\n<td style=\"text-align:center\">项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>name</td>\n<td style=\"text-align:center\">流程定义名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>description</td>\n<td style=\"text-align:center\">流程定义描述信息</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>globalParams</td>\n<td style=\"text-align:center\">全局参数</td>\n<td>string</td>\n</tr>\n<tr>\n<td>save</td>\n<td>connects</td>\n<td style=\"text-align:center\">流程定义节点图标连接信息(json格式)</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>locations</td>\n<td style=\"text-align:center\">流程定义节点坐标位置信息(json格式)</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td><strong>timeout</strong></td>\n<td style=\"text-align:center\"><strong>超时分钟数</strong></td>\n<td><strong>int</strong></td>\n</tr>\n<tr>\n<td></td>\n<td><strong>tenantId</strong></td>\n<td style=\"text-align:center\"><strong>租户id</strong></td>\n<td><strong>int</strong></td>\n</tr>\n<tr>\n<td></td>\n<td><strong>taskRelationJson</strong></td>\n<td style=\"text-align:center\"><strong>任务关系(json格式)</strong></td>\n<td><strong>string</strong></td>\n</tr>\n<tr>\n<td>--</td>\n<td>--</td>\n<td style=\"text-align:center\">--</td>\n<td>--</td>\n</tr>\n<tr>\n<td></td>\n<td>projectName</td>\n<td style=\"text-align:center\">项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td><strong>code</strong></td>\n<td style=\"text-align:center\"><strong>流程定义code</strong></td>\n<td><strong>long</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>name</td>\n<td style=\"text-align:center\">流程定义名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>description</td>\n<td style=\"text-align:center\">流程定义描述信息</td>\n<td>string</td>\n</tr>\n<tr>\n<td>update</td>\n<td>releaseState</td>\n<td style=\"text-align:center\">发布流程定义,可用值:OFFLINE,ONLINE</td>\n<td>ref</td>\n</tr>\n<tr>\n<td></td>\n<td>connects</td>\n<td style=\"text-align:center\">流程定义节点图标连接信息(json格式)</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>locations</td>\n<td style=\"text-align:center\">流程定义节点坐标位置信息(json格式)</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td><strong>timeout</strong></td>\n<td style=\"text-align:center\"><strong>超时分钟数</strong></td>\n<td><strong>int</strong></td>\n</tr>\n<tr>\n<td></td>\n<td><strong>tenantId</strong></td>\n<td style=\"text-align:center\"><strong>租户id</strong></td>\n<td><strong>int</strong></td>\n</tr>\n<tr>\n<td></td>\n<td><strong>taskRelationJson</strong></td>\n<td style=\"text-align:center\"><strong>任务关系(json格式)</strong></td>\n<td><strong>string</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>--</td>\n<td style=\"text-align:center\">--</td>\n<td>--</td>\n</tr>\n<tr>\n<td></td>\n<td><strong>code</strong></td>\n<td style=\"text-align:center\"><strong>流程定义code</strong></td>\n<td><strong>long</strong></td>\n</tr>\n<tr>\n<td>switch/deleteCode</td>\n<td>projectName</td>\n<td style=\"text-align:center\">项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>version</td>\n<td style=\"text-align:center\">版本号</td>\n<td>string</td>\n</tr>\n</tbody>\n</table>\n<p>备注：taskRelationJson格式：[{&quot;name&quot;:&quot;&quot;,&quot;pre_task_code&quot;:0,&quot;pre_task_version&quot;:0,&quot;post_task_code&quot;:123456789,&quot;post_task_version&quot;:1,&quot;condition_type&quot;:0,&quot;condition_params&quot;:{}},{&quot;name&quot;:&quot;&quot;,&quot;pre_task_code&quot;:123456789,&quot;pre_task_version&quot;:1,&quot;post_task_code&quot;:123451234,&quot;post_task_version&quot;:1,&quot;condition_type&quot;:0,&quot;condition_params&quot;:{}}]</p>\n<p>同理其他接口请求参数processDefinitionId换成code</p>\n<p><strong>schedule</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">接口名称</th>\n<th style=\"text-align:left\">参数名称</th>\n<th>参数说明</th>\n<th>数据类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\"><strong>code</strong></td>\n<td><strong>流程定义code</strong></td>\n<td><strong>long</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">projectName</td>\n<td>项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">failureStrategy</td>\n<td>失败策略,可用值:END,CONTINUE</td>\n<td>string</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">createSchedule</td>\n<td style=\"text-align:left\">processInstancePriority</td>\n<td>流程实例优先级,可用值:HIGHEST,HIGH,MEDIUM,LOW,LOWEST</td>\n<td>string</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">schedule</td>\n<td>定时</td>\n<td>string</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">warningGroupId</td>\n<td>发送组ID</td>\n<td>int</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">warningType</td>\n<td>发送策略,可用值:NONE,SUCCESS,FAILURE,ALL</td>\n<td>string</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">workerGroup</td>\n<td>workerGroup</td>\n<td>string</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">--</td>\n<td style=\"text-align:left\">--</td>\n<td>--</td>\n<td>--</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\"><strong>code</strong></td>\n<td><strong>流程定义code</strong></td>\n<td><strong>long</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">projectName</td>\n<td>项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">queryScheduleListPaging</td>\n<td style=\"text-align:left\">pageNo</td>\n<td>页码号</td>\n<td>int</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">pageSize</td>\n<td>页大小</td>\n<td>int</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:left\">searchVal</td>\n<td>搜索值</td>\n<td>string</td>\n</tr>\n</tbody>\n</table>\n<p><strong>taskDefinition</strong>(新增)</p>\n<table>\n<thead>\n<tr>\n<th>接口名称</th>\n<th>参数名称</th>\n<th>参数说明</th>\n<th>数据类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>save</td>\n<td>projectName</td>\n<td>项目名称</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>taskDefinitionJson</td>\n<td>task信息</td>\n<td>string</td>\n</tr>\n<tr>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n</tr>\n<tr>\n<td></td>\n<td>projectName</td>\n<td>项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td>update</td>\n<td>code</td>\n<td>task code</td>\n<td>long</td>\n</tr>\n<tr>\n<td></td>\n<td>taskDefinitionJson</td>\n<td>task信息</td>\n<td>string</td>\n</tr>\n<tr>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n</tr>\n<tr>\n<td></td>\n<td>projectName</td>\n<td>项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td>switch/deleteCode</td>\n<td>task_code</td>\n<td>taskCode</td>\n<td>long</td>\n</tr>\n<tr>\n<td></td>\n<td>version</td>\n<td>版本号</td>\n<td>int</td>\n</tr>\n<tr>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n</tr>\n<tr>\n<td>query/delete</td>\n<td>projectName</td>\n<td>项目名称</td>\n<td>string</td>\n</tr>\n<tr>\n<td></td>\n<td>task_code</td>\n<td>task code</td>\n<td>long</td>\n</tr>\n<tr>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n<td>--</td>\n</tr>\n<tr>\n<td>queryTaskListPaging</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>taskDefinitionJson：[{&quot;name&quot;:&quot;test&quot;,&quot;description&quot;:&quot;&quot;,&quot;task_type&quot;:&quot;SHELL&quot;,&quot;task_params&quot;:[],&quot;flag&quot;:0,&quot;task_priority&quot;:0,&quot;worker_group&quot;:&quot;default&quot;,&quot;fail_retry_times&quot;:0,&quot;fail_retry_interval&quot;:0,&quot;timeout_flag&quot;:0,&quot;timeout_notify_strategy&quot;:0,&quot;timeout&quot;:0,&quot;delay_time&quot;:0,&quot;resource_ids&quot;:&quot;&quot;}]</p>\n<p>对应需求issue</p>\n<pre><code>[Feature][JsonSplit-api] api module controller design #5498 \n1. [Feature][JsonSplit-api]processDefinition save/update interface  #5499 \n2. [Feature][JsonSplit-api]processDefinition switch interface #5501 \n3. [Feature][JsonSplit-api]processDefinition delete interface #5502 \n4. [Feature][JsonSplit-api]processDefinition copy interface #5503 \n5. [Feature][JsonSplit-api]processDefinition export interface #5504 \n6. [Feature][JsonSplit-api]processDefinition list-paging interface #5505 \n7. [Feature][JsonSplit-api]processDefinition move interface #5506 \n8. [Feature][JsonSplit-api]processDefinition queryProcessDefinitionAllByProjectId interface #5507 \n9. [Feature][JsonSplit-api]processDefinition select-by-id interface #5508 \n10. [Feature][JsonSplit-api]processDefinition view-tree interface #5509 \n11. [Feature][JsonSplit-api]schedule create interface #5510 \n12. [Feature][JsonSplit-api]schedule list-paging interface #5511 \n13. [Feature][JsonSplit-api]schedule update interface #5512 \n14. [Feature][JsonSplit-api]taskDefinition save interface #5513 \n15. [Feature][JsonSplit-api]taskDefinition update interface #5514 \n16. [Feature][JsonSplit-api]taskDefinition switch interface #5515 \n17. [Feature][JsonSplit-api]taskDefinition query interface #5516 \n18. [Feature][JsonSplit-api]taskDefinition delete interface #5517 \n19. [Feature][JsonSplit-api]WorkFlowLineage interface #5518 \n20. [Feature][JsonSplit-api]analysis interface #5519 \n21. [Feature][JsonSplit-api]executors interface #5520 \n22. [Feature][JsonSplit-api]processInstance interface #5521 \n23. [Feature][JsonSplit-api]project interface #5522 \n</code></pre>\n",
  "time": "2021-05-29",
  "author": "进勇",
  "title": "DolphinScheduler 核心之 DAG 大 JSON 拆分详解",
  "type": "tech",
  "label": "技术详解"
}