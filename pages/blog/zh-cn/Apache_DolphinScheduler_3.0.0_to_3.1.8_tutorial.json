{
  "__html": "<hr>\n<h2>title: Apache DolphinScheduler 3.0.0 升级到 3.1.8 教程\nkeywords: Apache DolphinScheduler, 升级, 教程\ndescription: 安装部署的流程可参考官网的文档Version 3.1.8/部署指南/伪集群部署安装部署的流程可参考官网的文档</h2>\n<h2>背景介绍</h2>\n<p><a href=\"https://dolphinscheduler.apache.org/zh-cn/docs/3.1.8/guide/installation/pseudo-cluster\" title=\"Version 3.1.8/部署指南/伪集群部署(Pseudo-Cluster)\">Version 3.1.8/部署指南/伪集群部署(Pseudo-Cluster)\nhttps://dolphinscheduler.apache.org/zh-cn/docs/3.1.8/guide/installation/pseudo-cluster</a></p>\n<p>本文开始之前，我先补充说明一下升级 Apache DolphinScheduler 的几个关键点</p>\n<h2>元数据备份</h2>\n<p>做好已有<strong>元数据做备份</strong>（以 MySQL 为例，<a href=\"https://so.csdn.net/so/search?q=%E5%85%83%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8&amp;spm=1001.2101.3001.7020\">元数据存储</a>在 Mysql 的 dolphinscheduler 数据库里）</p>\n<h3>伪代码</h3>\n<pre><code>mysqldump -u root -p dolphinscheduler &gt; dolphinscheduler_backup_XXX.sql\n</code></pre>\n<p>apache-dolphinscheduler-3.1.8-bin/bin/env/<strong>install_env.sh</strong></p>\n<p>apache-dolphinscheduler-3.1.8-bin/bin/env/<strong>dolphinscheduler_env.sh</strong></p>\n<p>这两个文件的配置项，可以从旧版本的相应文件里直接复制粘贴</p>\n<p>需要将使用到的数据库（比如 MySQL）的 connector (本人亲测 mysql-connector-java-8.0.30.jar 适用，其他 connector 版本未测试)放到相应的 libs 库里</p>\n<p><strong>api-server/libs</strong></p>\n<p><strong>alert-server/libs</strong></p>\n<p><strong>master-server/libs</strong></p>\n<p><strong>worker-server/libs</strong></p>\n<p><strong>tools/libs</strong></p>\n<p>伪代码如下</p>\n<pre><code>cp XXX/mysql-connector-java-8.0.30.jar XXX/apache-dolphinscheduler-3.1.8-bin/api-server/libs/\ncp XXX/mysql-connector-java-8.0.30.jar XXX/apache-dolphinscheduler-3.1.8-bin/alert-server/libs\ncp XXX/mysql-connector-java-8.0.30.jar XXX/apache-dolphinscheduler-3.1.8-bin/master-server/libs\ncp XXX/mysql-connector-java-8.0.30.jar XXX/apache-dolphinscheduler-3.1.8-bin/worker-server/libs\ncp XXX/mysql-connector-java-8.0.30.jar XXX/apache-dolphinscheduler-3.1.8-bin/tools/libs\n</code></pre>\n<p>common.properties 文件，需要修改相应的参数</p>\n<p><strong>alert-server/conf/common.properties</strong><br>\n<strong>api-server/conf/common.properties</strong><br>\n<strong>master-server/conf/common.properties</strong><br>\n<strong>worker-server/conf/common.properties</strong></p>\n<p>本人升级时，只修改了</p>\n<p>api-server/conf/common.properties</p>\n<p>worker-server/conf/common.properties</p>\n<p>这两个文件的三个参数</p>\n<p>（</p>\n<p>resource.storage.type</p>\n<p>resource.storage.upload.base.path</p>\n<p>resource.hdfs.fs.defaultFS</p>\n<p>）</p>\n<p>需要注意的是，3.1.8 此文件的有些参数名和 3.0.0 此文件中的参数名有变化。</p>\n<p><em>3.0.0 参数</em> <em>resource.upload.path</em></p>\n<p><strong>对应</strong></p>\n<p>3.1.8 参数 resource.storage.upload.base.path</p>\n<p><em>3.0.0 参数</em> <em>fs.defaultFS</em></p>\n<p><strong>对应</strong></p>\n<p>3.1.8 参数 resource.hdfs.fs.defaultFS</p>\n<h2>CDH集群升级</h2>\n<p>如果是 CDH 集群（比如 CDH 6.2.1）升级使用  Apache DolphinScheduler 3.1.8</p>\n<p>还需要替换相应的 Zookeeper jar 包， **否则会有  Zookeeper Failed to delete registry key 报错提示</p>\n<p>**</p>\n<h3>参考文章</h3>\n<p>Dolphin3.0在伪集群模式下总是会报zookeeper Failed to delete registry key，我该怎么排查这个问题：\n<em>https://github.com/apache/dolphinscheduler/discussions/11948</em></p>\n<p>看看是不是 Zookeeper 的版本不兼容，DolphinScheduler3.1.8 版本的 zookeeper 和 curator 是下面这个:</p>\n<p>curator-client-5.3.0.jar<br>\ncurator-recipes-5.3.0.jar<br>\ncurator-framework-5.3.0.jar<br>\nzookeeper-3.8.0.jar</p>\n<p>将/api-server/libs，master-server/libs，worker-server/libs，/tools/libs 下的 zookeeper，curator 的版本<strong>替换成 Zookeeper 服务版本一致</strong>才行。</p>\n<p><strong>注意</strong>：zookeeper-3.4.x 对应的 curator-*版本必须是 4.2.0</p>\n<p>CDH6.2.1 使用的是</p>\n<p>ZooKeeper</p>\n<p>3.4.5+cdh6.2.1</p>\n<p>即 Zookeeper-3.4.5 版本，需要下载相应的 jar 包  zookeeper-3.4.5.jar,可从如下网站上搜索下载 jar 包:<em>https://nowjava.com/jar/</em></p>\n<p>此外还需要下载下面三个 jar 包</p>\n<ul>\n<li>curator-client-4.2.0.jar</li>\n<li>curator-recipes-4.2.0.jar</li>\n<li>curator-framework-4.2.0.jar</li>\n</ul>\n<p>即：</p>\n<ul>\n<li>zookeeper-3.4.5.jar</li>\n<li>curator-client-4.2.0.jar</li>\n<li>curator-recipes-4.2.0.jar</li>\n<li>curator-framework-4.2.0.jar</li>\n</ul>\n<p>将这 4 个 jar 包放到如下</p>\n<ul>\n<li>api-server/libs</li>\n<li>master-server/libs</li>\n<li>worker-server/libs</li>\n<li>tools/libs</li>\n</ul>\n<p>这四个目录，并替换原先的版本 jar 包，伪代码如下</p>\n<pre><code>####################### \ncd XXX/apache-dolphinscheduler-3.1.8-bin/api-server/libs/ \n\nrm -f zookeeper-3.8.0.jar\ncp XXXX/zookeeper-3.4.5.jar . \n\nrm -f curator-*\ncp XXXX/curator-*4.2* . \n\n####################### \n\ncd XXX/apache-dolphinscheduler-3.1.8-bin/master-server/libs \n\nrm -f zookeeper-3.8.0.jar\ncp XXXX/zookeeper-3.4.5.jar . \n\nrm -f curator-*\ncp XXXX/curator-*4.2* . \n\n####################### \n\ncd XXX/apache-dolphinscheduler-3.1.8-bin/worker-server/libs \n\nrm -f zookeeper-3.8.0.jar\ncp XXXX/zookeeper-3.4.5.jar . \n\nrm -f curator-*\ncp XXXX/curator-*4.2* . \n\n####################### \n\ncd XXX/apache-dolphinscheduler-3.1.8-bin/tools/libs \n\nrm -f zookeeper-3.8.0.jar\ncp XXXX/zookeeper-3.4.5.jar . \n\nrm -f curator-*\ncp XXXX/curator-*4.2* . \n\n#######################\n</code></pre>\n<p>以上这五点都修改完后，停掉 Apache DolphinScheduler 3.0.0</p>\n<h3>伪代码</h3>\n<pre><code>su - dolphinschedulercd XXXX/apache-dolphinscheduler-3.0.0-bin# 一键停止集群所有服务bash ./bin/stop-all.sh\n</code></pre>\n<p>初始化 DolphinScheduler 3.1.8</p>\n<pre><code>cd XXXX/apache-dolphinscheduler-3.1.8-bin \n\nsh ./tools/bin/upgrade-schema.sh\n\n\ncd XXXX/apache-dolphinscheduler-3.1.8-bin \n\nsh ./bin/install.sh\n</code></pre>\n<p>到这里就升级完成了</p>\n",
  "time": "2023-11-21",
  "author": "Niko_Zeng",
  "title": "Apache DolphinScheduler 3.0.0 升级到 3.1.8 教程？",
  "type": "tutorial",
  "label": "教程"
}